//----------------------------------------------------------------
// Copyright (C) by HAMILTON Bonaduz AG, CH-7402 Bonaduz.
// All rights reserved.
//
// Project:     driver library
// Description: This library contains functions to control the an Inheco ODTC device
//
// Revision history:
//
// 2013-09-13   v 1.0   Bernd Huf
//              - library created
// 2014-09-22   v 1.0.3   Lutz Geisen
//              - First functions integrated
// 2014-12-12   v 1.0.4   Lutz Geisen
//              - Adapted for Nimbus and FirmwareChange
// 2015-01-09   v 1.0.5   Lutz Geisen
//              - Adapted for FirmwareChange
// 2015-01-23   v 1.0.6   Lutz Geisen
//              - CodeReview and again adapted for FirmwareChange
//              - changed mode for multiple devices to be handled in HSL part
// 2015-03-06   v1.0.7    Bernd Huf
//              - minor bugfix in error trace
//              - initialize callback functions with empty string
// 2015-06-12   v1.0.8    Bernd Huf
//              - new function SetTraceLevel
// 2015-06-17   v1.0.9    Bernd Huf
//              - disable sending of Data events in function Initialize
// 2015-10-20   v1.0.10   Bernd Huf
//              - removed callback functions (memory leak problem)
//              - removed function fire...event methods (events now working)
//              - removed function TerminateAllDevicesAndLibrary
//              - removed function Delay
//              - changed COM-Events due to changed C#-DLL
//              - rearranged functions according to usage
//              - renamed some function parameters for better readability
//              - defined namespaces 'Standard' and 'Advanced' to group functions
//              - changed function 'StartExecuteProtocol' to function 'DownloadProtocol'
//              - added advanced function 'DisableTemperatureEvent'
// 2016-01-08   v1.0.11   Bernd Huf
//              - bugfix: added check for simulation mode in fuction 'DownloadProtocol'
//----------------------------------------------------------------

#ifndef __Inheco_ODTC__
  #define __Inheco_ODTC__ 1

  #ifndef __TraceLevel_hsl__
    #include "ASWStandard\\TraceLevel\\TraceLevel.hsl"
  #endif

  #ifndef __ASWGLOBAL_hsl__
    #include "ASWStandard\\ASWGlobal\\ASWGlobal.hsl"
  #endif

  #ifndef __Hamilton_DriverTools_hsl__
    #include "Hamilton DriverTools\\Hamilton DriverTools.hsl"
  #endif

  namespace Inheco_ODTC
  {
    // --------------------------------------------------------------------------------------
    // public constant declarations
    // --------------------------------------------------------------------------------------
    namespace LogLevel
    {
      const variable Debug                                    ("DEBUG");
      const variable Info                                     ("INFO");
      const variable Warning                                  ("WARN");
      const variable Error                                    ("ERROR");
      const variable Fatal                                    ("FATAL");
    }

    // --------------------------------------------------------------------------------------
    // private constant declarations
    // --------------------------------------------------------------------------------------
    static const variable ERROR_DEVBUSY                       (4);
    static const variable ERROR_ONLOCKID                      (5);
    static const variable ERROR_REQUESTID                     (6);
    static const variable ERROR_COMMANDNOTALLOWED             (9);
    static const variable ERROR_INVALIDCOMANDPARAM            (11);
    static const variable FINISHEDWITHWARNING                 (12);

    static const variable ERROR_HARDWARE                      (1000);
    static const variable ERROR_COMMUNICATION                 (1001);
    static const variable ERROR_PMSSOFTWARE                   (1002);
    static const variable ERROR_DEVICEPLUGIN                  (1003);
    static const variable WARNING_GENERALWARNING              (1004);

    static const variable ERROR_HARDWARERUN                   (2000);
    static const variable ERROR_CONNECTION_ODTC_PCU           (2001);
    static const variable ERROR_DOOR                          (2002);
    static const variable ERROR_ODTCMETHODERROR               (2003);
    static const variable ERROR_UNEXPECTEDBUSERROR            (2004);
    static const variable WARNING_TEMPERATUREOUTOFSPEC        (2005);
    static const variable WARNING_GENERALWARNING_2            (2006);
    static const variable ERROR_ACPOWERLOSS                   (2007);

    static const variable ERROR_MSG_DEVBUSY                   ("Device is busy due to other command execution.");
    static const variable ERROR_MSG_ONLOCKID                  ("Invalid lock ID.");
    static const variable ERROR_MSG_REQUESTID                 ("Invalid request ID.");
    static const variable ERROR_MSG_COMMANDNOTALLOWED         ("Command not allowed in this state.");
    static const variable ERROR_MSG_INVALIDCOMANDPARAM        ("Invalid command parameter.");
    static const variable WARNING_MSG_FINISHEDWITHWARNING     ("Command finished with warning(s).");
    static const variable ERROR_MSG_HARDWARE                  ("Device: internal software error.");
    static const variable ERROR_MSG_COMMUNICATION             ("Device: internal bus communication error.");
    static const variable ERROR_MSG_PMSSOFTWARE               ("PMS connector error.");
    static const variable ERROR_MSG_DEVICEPLUGIN              ("Device plugin error.");
    static const variable WARNING_MSG_GENERALWARNING          ("General warning.");
    static const variable ERROR_MSG_HARDWARERUN               ("Hardware error while operation.");
    static const variable ERROR_MSG_CONNECTION_ODTC_PCU       ("Device error: internal connection failure.");
    static const variable ERROR_MSG_DOOR                      ("Device error (uncorrectable): Door error.");
    static const variable ERROR_MSG_ODTCMETHODERROR           ("Device error (uncorrectable): Method error.");
    static const variable ERROR_MSG_UNEXPECTEDBUSERROR        ("Device error (uncorrectable): Unexpected bus communication erturn value.");
    static const variable WARNING_MSG_TEMPERATUREOUTOFSPEC    ("Device warning: Temperature out of specification.");
    static const variable WARNING_MSG_GENERALWARNING_2        ("General warning.");
    static const variable ERROR_MSG_ACPOWERLOSS               ("Device error: AC power loss.");

    static const variable MAX_INT                             (2147483647);
    static const variable MAX_DEVICES                         (4);

    // --------------------------------------------------------------------------------------
    // global constant/variable declarations
    // --------------------------------------------------------------------------------------
    static global event     gInheco_ODTC_hdlMainCriticalSection;
    static global variable  gInheco_ODTC_blnSimulationMode            (ASWGLOBAL::BOOL::FALSE);
    static global variable  gInheco_ODTC_blnSemaphoreInitialized      (hslFalse);
    static global variable  gInheco_ODTC_blnInitialized               (hslFalse);
    static global variable  gInheco_ODTC_intTraceLevel                (TRACE_LEVEL_DEBUG);
    static global variable  gInheco_ODTC_strModuleName                ("Inheco ODTC");
    static global variable  gInheco_ODTC_strVersion                   ("1.0.10");

    static global object    gInheco_ODTC_arrobjDevices[]              (MAX_DEVICES + 1);
    static global event     gInheco_ODTC_arrhdlCriticalSections[]     (MAX_DEVICES + 1);
    static global variable  gInheco_ODTC_arrstrIPAddresses[]          (MAX_DEVICES + 1);

    static global object    gInheco_ODTC_objDevice_01;
    static global object    gInheco_ODTC_objDevice_02;
    static global object    gInheco_ODTC_objDevice_03;
    static global object    gInheco_ODTC_objDevice_04;

    // --------------------------------------------------------------------------------------
    // function declarations
    // --------------------------------------------------------------------------------------
    namespace Standard
    {
      function Connect(variable i_strLocalIP,
                       variable i_strDeviceIP,
                       variable i_strDevicePort,
                       variable i_blnSimulationMode,
                       variable& o_intDeviceID,
                       variable& o_strMessage) variable;

      function Reset(variable i_intDeviceID,
                     variable i_blnSimulateOnDeviceBase,
                     variable i_intTimeToWait, 
                     variable i_strLockID, 
                     variable i_strDeviceId, 
                     variable i_strPMSId, 
                     variable& o_intSiLAReturnValue,
                     variable& o_strSiLAMessage) variable;

      function Initialize(variable i_intDeviceID,
                          variable i_strLockID,
                          variable& o_intSiLAReturnValue,
                          variable& o_strSiLAMessage) variable;

      function OpenDoor(variable i_intDeviceID,
                        variable i_strLockID,
                        variable& o_intSiLAReturnValue,
                        variable& o_strSiLAMessage) variable;
    
      function CloseDoor(variable i_intDeviceID,
                         variable i_strLockID,
                         variable& o_intSiLAReturnValue,
                         variable& o_strSiLAMessage) variable;

      function DownloadProtocol(variable i_intDeviceID,
                                variable i_strLockID,
                                variable i_strProtocolFile,
                                variable& o_intSiLAReturnValue,
                                variable& o_strSiLAMessage) variable;

      function ExecuteMethod(variable i_intDeviceID,
                             variable i_strLockID,
                             variable i_strMethodName, 
                             variable i_intPriority,
                             variable& o_intDuration,
                             variable& o_intRequestId,
                             variable& o_intSiLAReturnValue,
                             variable& o_strSiLAMessage) variable;

      function WaitForEndOfExecuteMethod(variable i_intDeviceID,
                                         variable i_intTimeOut,
                                         variable i_intRequestId,
                                         variable& o_intSiLAReturnValue,
                                         variable& o_strSiLAMessage) variable;

      function StopMethod(variable i_intDeviceID,
                          variable i_strLockID,
                          variable& o_intSiLAReturnValue,
                          variable& o_strSiLAMessage) variable;

      function Abort(variable i_intDeviceID,
                     variable i_strLockID,
                     variable& o_intSiLAReturnValue,
                     variable& o_strSiLAMessage) variable;

      function GetStatus(variable i_intDeviceID,
                         variable& o_strDeviceId, 
                         variable& o_strState,
                         variable& o_blnLocked, 
                         variable& o_strPMSId, 
                         variable& o_strCurrentTime,
                         variable& o_intSiLAReturnValue,
                         variable& o_strSiLAMessage) variable;

      function SetTraceLevel(variable i_intTraceLevel) void;

      function ReadActualTemperature(variable i_intDeviceID,
                                     variable i_strLockID,
                                     variable& o_strTime,
                                     variable& o_arrfltActualTemperatures[],
                                     variable& o_arrstrActualTemperatureNames[],
                                     variable& o_intSiLAReturnValue,
                                     variable& o_strSiLAMessage) variable;

      function Terminate(variable i_intDeviceID,
                         variable& o_strSiLAMessage) variable;

      function EvaluateError(variable i_intErrorCode,
                             variable& o_strErrorMessage) variable;

    } // namespace Standard

    namespace Advanced
    {
      function AddAllowedReturnCode(variable i_intDeviceID,
                                    variable i_intReturnValueToIgnore) variable;

      function LockDevice(variable i_intDeviceID,
                          variable i_intTimeout, 
                          variable i_strPMSID, 
                          variable i_strLockID,
                          variable& o_intSiLAReturnValue,
                          variable& o_strSiLAMessage) variable;

      function UnlockDevice(variable i_intDeviceID,
                            variable i_strLockID,
                            variable& o_intSiLAReturnValue,
                            variable& o_strSiLAMessage) variable;

      function SetCSVSeparator(variable i_intDeviceID,
                               variable i_strLockID,
                               variable i_strCSVSeparator,
                               variable& o_intSiLAReturnValue,
                               variable& o_strSiLAMessage) variable;

      function SetDateTime(variable i_intDeviceID,
                           variable i_strLockID,
                           variable i_strDateTime,
                           variable& o_intSiLAReturnValue,
                           variable& o_strSiLAMessage) variable;

      function SetNetWorkConfig(variable i_intDeviceID,
                                variable i_strLockID,
                                variable i_strIPAddress,
                                variable i_strSubNet,
                                variable i_strGateWay,
                                variable i_strDNS1,
                                variable i_strDNS2,
                                variable& o_intSiLAReturnValue,
                                variable& o_strSiLAMessage) variable;

      function GetParameters(variable i_intDeviceID,
                             variable i_strLockID,
                             variable& o_strParametersXML,
                             variable& o_intSiLAReturnValue,
                             variable& o_strSiLAMessage) variable;

      function GetDeviceIdentification(variable i_intDeviceID,
                                       variable i_strLockID,
                                       variable& o_strDeviceFirmwareVersion, 
                                       variable& o_strDeviceManufacturer,
                                       variable& o_strDeviceName, 
                                       variable& o_strDeviceSerialNumber, 
                                       variable& o_strSiLAInterfaceVersion,
                                       variable& o_strSiLASubDeviceClass, 
                                       variable& o_strWsdl,
                                       variable& o_intSiLAReturnValue,
                                       variable& o_strSiLAMessage) variable;

      function GetConfiguration(variable i_intDeviceID,
                                variable i_strLockID,
                                variable i_intConfigLevel, 
                                variable i_strPassword, 
                                variable& o_strConfigurationXML,
                                variable& o_intSiLAReturnValue,
                                variable& o_strSiLAMessage)variable;

      function Pause(variable i_intDeviceID,
                     variable i_strLockID,
                     variable& o_intSiLAReturnValue,
                     variable& o_strSiLAMessage) variable;

      function DisableTemperatureEvent(variable i_intDeviceID,
                                       variable i_strLockID,
                                       variable& o_intSiLAReturnValue,
                                       variable& o_strSiLAMessage) variable;

      function DoContinue(variable i_intDeviceID,
                          variable i_strLockID,
                          variable& o_intSiLAReturnValue,
                          variable& o_strSiLAMessage) variable;

      function SetParameters(variable i_intDeviceID,
                             variable i_strLockID,
                             variable i_strParameterName,
                             variable i_strParameterType,
                             variable i_strParameterValue,
                             variable& o_intSiLAReturnValue,
                             variable& o_strSiLAMessage) variable;

      function SetLogLevel(variable i_intDeviceID,
                           variable i_strLockID,
                           variable i_strLogLevel,
                           variable &o_intSiLAReturnValue,
                           variable &o_strSiLAMessage) variable;

      function RegisterStatusEventURL(variable i_intDeviceID,
                                      variable i_strLockID, 
                                      variable i_strURL, 
                                      variable i_strEventInterVal,
                                      variable& o_intSiLAReturnValue,
                                      variable& o_strSiLAMessage) variable;

      function UnregisterStatusEventURL(variable i_intDeviceID,
                                        variable i_strLockID,
                                        variable i_strURL,
                                        variable& o_intSiLAReturnValue,
                                        variable& o_strSiLAMessage) variable;

      function GetLastData(variable i_intDeviceID,
                           variable i_strLockID,
                           variable& o_strResult,
                           variable& o_intSiLAReturnValue,
                           variable& o_strSiLAMessage) variable;
    } // namespace Advanced

    // --------------------------------------------------------------------------------------
    // private function declarations
    // --------------------------------------------------------------------------------------
    private function _InitializeLibrary(variable i_strCallingFunctionName) variable;

    private function _GetFreeDeviceNumber(variable i_strIPAddress,
                                          variable& o_blnAlreadyUsed,
                                          variable& o_intDeviceID) variable;

    namespace Standard
    {
      //----------------------------------------------------------------------------------------------
      // function Connect
      //----------------------------------------------------------------------------------------------
      function Connect(variable i_strLocalIP,
                       variable i_strDeviceIP,
                       variable i_strDevicePort,
                       variable i_blnSimulationMode,
                       variable& o_intDeviceID,
                       variable& o_strMessage) variable
      {
        variable strCurrentDir(""), strFunctionName("");
        object objShell, objDevice;
        variable blnAlreadyUsed;

        if(Hamilton_DriverTools::ExtractFunctionName(GetFunctionName(),
                                                     strFunctionName,
                                                     gInheco_ODTC_strModuleName) == ASWGLOBAL::BOOL::FALSE) return(ASWGLOBAL::BOOL::FALSE);

        if(Hamilton_DriverTools::CheckString(i_strLocalIP,
                                             "i_strLocalIP",
                                             strFunctionName,
                                             gInheco_ODTC_strModuleName) == ASWGLOBAL::BOOL::FALSE) return(ASWGLOBAL::BOOL::FALSE);

        if(Hamilton_DriverTools::CheckString(i_strDeviceIP,
                                             "i_strDeviceIP",
                                             strFunctionName,
                                             gInheco_ODTC_strModuleName) == ASWGLOBAL::BOOL::FALSE) return(ASWGLOBAL::BOOL::FALSE);
 
        if(Hamilton_DriverTools::CheckString(i_strDevicePort,
                                            "i_strDevicePort",
                                            strFunctionName,
                                            gInheco_ODTC_strModuleName) == ASWGLOBAL::BOOL::FALSE) return(ASWGLOBAL::BOOL::FALSE);

        if(Hamilton_DriverTools::CheckBool(i_blnSimulationMode,
                                           "i_blnSimulationMode",
                                           strFunctionName,
                                           gInheco_ODTC_strModuleName) == ASWGLOBAL::BOOL::FALSE) return(ASWGLOBAL::BOOL::FALSE);

        Hamilton_DriverTools::StatusTrace(Hamilton_DriverTools::ACTION::START,
                                          TRACE_LEVEL_DEBUG,
                                          "i_strLocalIP = '" + i_strLocalIP + "'" +
                                          ", i_strDeviceIP = '" + i_strDeviceIP + "'" +
                                          ", i_strDevicePort = '" + i_strDevicePort + "'" +
                                          ", i_blnSimulationMode = " + IStr(i_blnSimulationMode),
                                          strFunctionName,
                                          gInheco_ODTC_intTraceLevel,
                                          gInheco_ODTC_strModuleName);
  
        if(i_strDeviceIP == "")
        {
           Hamilton_DriverTools::StatusTrace(Hamilton_DriverTools::ACTION::COMPLETE_WITH_ERROR,
                                             TRACE_LEVEL_RELEASE,
                                             "i_strDeviceIP is empty!",
                                             strFunctionName,
                                             gInheco_ODTC_intTraceLevel,
                                             gInheco_ODTC_strModuleName);
           return(ASWGLOBAL::BOOL::FALSE);
        }

        gInheco_ODTC_intTraceLevel = TRACELEVEL::GetTraceLevel();
        gInheco_ODTC_blnSimulationMode = i_blnSimulationMode;

        Hamilton_DriverTools::StatusTrace(Hamilton_DriverTools::ACTION::PROGRESS,
                                            TRACE_LEVEL_DEBUG,
                                            "Library version = " + gInheco_ODTC_strVersion,
                                            strFunctionName,
                                            gInheco_ODTC_intTraceLevel,
                                            gInheco_ODTC_strModuleName);

        if(gInheco_ODTC_blnSimulationMode == ASWGLOBAL::BOOL::TRUE)
        {
          Hamilton_DriverTools::StatusTrace(Hamilton_DriverTools::ACTION::COMPLETE,
                                            TRACE_LEVEL_DEBUG,
                                            "Simulated",
                                            strFunctionName,
                                            gInheco_ODTC_intTraceLevel,
                                            gInheco_ODTC_strModuleName);
          o_intDeviceID=1;
          return (ASWGLOBAL::BOOL::TRUE);
        }

        if(!gInheco_ODTC_blnSemaphoreInitialized)
        {
          gInheco_ODTC_hdlMainCriticalSection.SetEvent();
          gInheco_ODTC_blnSemaphoreInitialized = hslTrue;
        }

        gInheco_ODTC_hdlMainCriticalSection.WaitEvent(hslInfinite);

        if(!_InitializeLibrary(strFunctionName))
        {
          gInheco_ODTC_hdlMainCriticalSection.SetEvent();
          return(ASWGLOBAL::BOOL::FALSE);
        }

        if(!_GetFreeDeviceNumber(i_strDeviceIP, blnAlreadyUsed, o_intDeviceID))
        {
          gInheco_ODTC_hdlMainCriticalSection.SetEvent();
          Hamilton_DriverTools::StatusTrace(Hamilton_DriverTools::ACTION::COMPLETE_WITH_ERROR,
                                            TRACE_LEVEL_RELEASE,
                                            "All " + IStr(MAX_DEVICES) + " possible IP addresses used!",
                                            strFunctionName,
                                            gInheco_ODTC_intTraceLevel,
                                            gInheco_ODTC_strModuleName);
          return(ASWGLOBAL::BOOL::FALSE);
        }

        if(blnAlreadyUsed) 
        {
          gInheco_ODTC_hdlMainCriticalSection.SetEvent();
          Hamilton_DriverTools::StatusTrace(Hamilton_DriverTools::ACTION::COMPLETE,
                                            TRACE_LEVEL_DEBUG,
                                            "Already connected to ip '" + i_strDeviceIP + "'",
                                            strFunctionName,
                                            gInheco_ODTC_intTraceLevel,
                                            gInheco_ODTC_strModuleName);
           return (ASWGLOBAL::BOOL::TRUE);
        }

        Hamilton_DriverTools::StatusTraceArray(Hamilton_DriverTools::ACTION::PROGRESS,
                                               TRACE_LEVEL_DEBUG,
                                               gInheco_ODTC_arrstrIPAddresses,
                                               "Connected device",
                                               strFunctionName,
                                               TRACE_LEVEL_RELEASE,
                                               gInheco_ODTC_strModuleName) ;

        // temporarily set current directory to ODTC directory
        onerror goto WSHSHELL_ERROR;
        objShell.CreateObject("WScript.Shell");
        strCurrentDir = objShell.CurrentDirectory;
        objShell.CurrentDirectory = GetLibraryPath() + "\\Inheco ODTC";
        onerror goto 0;

        onerror goto DLL_ERROR;
        gInheco_ODTC_arrhdlCriticalSections[o_intDeviceID].WaitEvent(hslInfinite);
        objDevice = gInheco_ODTC_arrobjDevices.ElementAt(o_intDeviceID);
        if(!objDevice.Connect(i_strLocalIP, 
                              i_strDeviceIP,
                              i_strDevicePort,
                              gInheco_ODTC_intTraceLevel,
                              o_strMessage))
        {
          gInheco_ODTC_arrhdlCriticalSections[o_intDeviceID].SetEvent();
          gInheco_ODTC_hdlMainCriticalSection.SetEvent();
          onerror goto 0;
          Hamilton_DriverTools::StatusTrace(Hamilton_DriverTools::ACTION::COMPLETE_WITH_ERROR,
                                            TRACE_LEVEL_RELEASE,
                                            "Failed to connect to device: '" + o_strMessage + "', see logfile for details !",
                                            strFunctionName,
                                            gInheco_ODTC_intTraceLevel,
                                            gInheco_ODTC_strModuleName);
          return(ASWGLOBAL::BOOL::FALSE);
        }
        gInheco_ODTC_arrhdlCriticalSections[o_intDeviceID].SetEvent();
        onerror goto 0;

        // reset current directory
        onerror goto WSHSHELL_ERROR;
        objShell.CurrentDirectory = strCurrentDir;
        objShell.ReleaseObject();
        onerror goto 0;

        gInheco_ODTC_hdlMainCriticalSection.SetEvent();
        Hamilton_DriverTools::StatusTrace(Hamilton_DriverTools::ACTION::COMPLETE,
                                          TRACE_LEVEL_DEBUG,
                                          "o_intDeviceID = " + IStr(o_intDeviceID) +
                                          ", o_strMessage =¨'" + o_strMessage + "'",
                                          strFunctionName,
                                          gInheco_ODTC_intTraceLevel,
                                          gInheco_ODTC_strModuleName);
        return(ASWGLOBAL::BOOL::TRUE);

        WSHSHELL_ERROR:
        {
          gInheco_ODTC_hdlMainCriticalSection.SetEvent();
          Hamilton_DriverTools::StatusTrace(Hamilton_DriverTools::ACTION::COMPLETE_WITH_ERROR,
                                            TRACE_LEVEL_RELEASE,
                                            "Error setting current directory !",
                                            strFunctionName,
                                            gInheco_ODTC_intTraceLevel,
                                            gInheco_ODTC_strModuleName);
          return (ASWGLOBAL::BOOL::FALSE);
        }

        DLL_ERROR:
        {
          gInheco_ODTC_arrhdlCriticalSections[o_intDeviceID].SetEvent();
          gInheco_ODTC_hdlMainCriticalSection.SetEvent();
          Hamilton_DriverTools::StatusTrace(Hamilton_DriverTools::ACTION::COMPLETE_WITH_ERROR,
                                            TRACE_LEVEL_RELEASE,
                                            "Unhandled exception in dll or dll missing!",
                                            strFunctionName,
                                            gInheco_ODTC_intTraceLevel,
                                            gInheco_ODTC_strModuleName);
          return(ASWGLOBAL::BOOL::FALSE);
        }
      } // Connect

      //----------------------------------------------------------------------------------------------
      // function Reset
      //----------------------------------------------------------------------------------------------
      function Reset(variable i_intDeviceID,
                     variable i_blnSimulateOnDeviceBase,
                     variable i_intTimeToWait, 
                     variable i_strLockID, 
                     variable i_strDeviceId, 
                     variable i_strPMSId, 
                     variable& o_intSiLAReturnValue,
                     variable& o_strSiLAMessage) variable
      {
        object objDevice;
        variable strFunctionName("");

        if(Hamilton_DriverTools::ExtractFunctionName(GetFunctionName(),
                                                     strFunctionName,
                                                     gInheco_ODTC_strModuleName) == ASWGLOBAL::BOOL::FALSE) return(ASWGLOBAL::BOOL::FALSE);

        if(Hamilton_DriverTools::CheckIntegerRange(i_intDeviceID,
                                                   "i_intDeviceID",
                                                   1,
                                                   MAX_DEVICES,
                                                   strFunctionName,
                                                   gInheco_ODTC_strModuleName) == ASWGLOBAL::BOOL::FALSE) return(ASWGLOBAL::BOOL::FALSE);

        if(Hamilton_DriverTools::CheckBool(i_blnSimulateOnDeviceBase,
                                           "i_blnSimulateOnDeviceBase",
                                           strFunctionName,
                                           gInheco_ODTC_strModuleName) == ASWGLOBAL::BOOL::FALSE) return(ASWGLOBAL::BOOL::FALSE);

        if(Hamilton_DriverTools::CheckIntegerRange(i_intTimeToWait,
                                                   "i_intTimeToWait",
                                                   0,
                                                   999999,
                                                   strFunctionName,
                                                   gInheco_ODTC_strModuleName) == ASWGLOBAL::BOOL::FALSE) return(ASWGLOBAL::BOOL::FALSE);

        if(Hamilton_DriverTools::CheckString(i_strLockID,
                                             "i_strLockID",
                                             strFunctionName,
                                             gInheco_ODTC_strModuleName) == ASWGLOBAL::BOOL::FALSE) return(ASWGLOBAL::BOOL::FALSE);

        if(Hamilton_DriverTools::CheckString(i_strDeviceId,
                                             "i_strDeviceId",
                                             strFunctionName,
                                             gInheco_ODTC_strModuleName) == ASWGLOBAL::BOOL::FALSE) return(ASWGLOBAL::BOOL::FALSE);

        if(Hamilton_DriverTools::CheckString(i_strPMSId,
                                             "i_strPMSId",
                                             strFunctionName,
                                             gInheco_ODTC_strModuleName) == ASWGLOBAL::BOOL::FALSE) return(ASWGLOBAL::BOOL::FALSE);

        Hamilton_DriverTools::StatusTrace(Hamilton_DriverTools::ACTION::START,
                                          TRACE_LEVEL_DEBUG,
                                          "i_intDeviceID = " + IStr(i_intDeviceID) +
                                          ", i_blnSimulateOnDeviceBase = " + IStr(i_blnSimulateOnDeviceBase) +
                                          ", i_intTimeToWait = " + IStr(i_intTimeToWait) +
                                          ", i_strLockID = '" + i_strLockID + "'" +
                                          ", i_strDeviceId = '" + i_strDeviceId + "'" +
                                          ", i_strPMSId = '" + i_strPMSId + "'",
                                          strFunctionName,
                                          gInheco_ODTC_intTraceLevel,
                                          gInheco_ODTC_strModuleName);

        if(gInheco_ODTC_blnSimulationMode == ASWGLOBAL::BOOL::TRUE)
        {
          Hamilton_DriverTools::StatusTrace(Hamilton_DriverTools::ACTION::COMPLETE,
                                            TRACE_LEVEL_DEBUG,
                                            "Simulated",
                                            strFunctionName,
                                            gInheco_ODTC_intTraceLevel,
                                            gInheco_ODTC_strModuleName);
          return (ASWGLOBAL::BOOL::TRUE);
        }

        onerror goto DLL_ERROR;
        gInheco_ODTC_arrhdlCriticalSections[i_intDeviceID].WaitEvent(hslInfinite);
        objDevice = gInheco_ODTC_arrobjDevices.ElementAt(i_intDeviceID);
        if(!objDevice.Reset(i_blnSimulateOnDeviceBase,
                            i_intTimeToWait, 
                            i_strLockID,
                            i_strDeviceId,
                            i_strPMSId,
                            o_intSiLAReturnValue,
                            o_strSiLAMessage))
        {
          gInheco_ODTC_arrhdlCriticalSections[i_intDeviceID].SetEvent();
          onerror goto 0;
          Hamilton_DriverTools::StatusTrace(Hamilton_DriverTools::ACTION::COMPLETE_WITH_ERROR,
                                            TRACE_LEVEL_RELEASE,
                                            "Failed to reset device " + IStr(i_intDeviceID) + ", see logfile for details !",
                                            strFunctionName,
                                            gInheco_ODTC_intTraceLevel,
                                            gInheco_ODTC_strModuleName);
          return(ASWGLOBAL::BOOL::FALSE);
        }

        gInheco_ODTC_arrhdlCriticalSections[i_intDeviceID].SetEvent();
        onerror goto 0;

        Hamilton_DriverTools::StatusTrace(Hamilton_DriverTools::ACTION::COMPLETE,
                                          TRACE_LEVEL_DEBUG,
                                          "o_intSiLAReturnValue = " + IStr(o_intSiLAReturnValue) +
                                          ", o_strSiLAMessage = '" + o_strSiLAMessage + "'",
                                          strFunctionName,
                                          gInheco_ODTC_intTraceLevel,
                                          gInheco_ODTC_strModuleName);
        return(ASWGLOBAL::BOOL::TRUE);

        DLL_ERROR:
        {
          gInheco_ODTC_arrhdlCriticalSections[i_intDeviceID].SetEvent();
          Hamilton_DriverTools::StatusTrace(Hamilton_DriverTools::ACTION::COMPLETE_WITH_ERROR,
                                            TRACE_LEVEL_RELEASE,
                                            "Unhandled exception in dll or dll missing!",
                                            strFunctionName,
                                            gInheco_ODTC_intTraceLevel,
                                            gInheco_ODTC_strModuleName);
          return(ASWGLOBAL::BOOL::FALSE);
        }
      } // Reset

      //----------------------------------------------------------------------------------------------
      // function Initialize
      //----------------------------------------------------------------------------------------------
      function Initialize(variable i_intDeviceID,
                          variable i_strLockID,
                          variable& o_intSiLAReturnValue,
                          variable& o_strSiLAMessage) variable
      {
        object objDevice;
        variable strFunctionName("");
        timer hdlDelay;

        if(Hamilton_DriverTools::ExtractFunctionName(GetFunctionName(),
                                                     strFunctionName,
                                                     gInheco_ODTC_strModuleName) == ASWGLOBAL::BOOL::FALSE) return(ASWGLOBAL::BOOL::FALSE);

        if(Hamilton_DriverTools::CheckIntegerRange(i_intDeviceID,
                                                   "i_intDeviceID",
                                                   1,
                                                   MAX_DEVICES,
                                                   strFunctionName,
                                                   gInheco_ODTC_strModuleName) == ASWGLOBAL::BOOL::FALSE) return(ASWGLOBAL::BOOL::FALSE);

        if(Hamilton_DriverTools::CheckString(i_strLockID,
                                             "i_strLockID",
                                             strFunctionName,
                                             gInheco_ODTC_strModuleName) == ASWGLOBAL::BOOL::FALSE) return(ASWGLOBAL::BOOL::FALSE);

        Hamilton_DriverTools::StatusTrace(Hamilton_DriverTools::ACTION::START,
                                          TRACE_LEVEL_DEBUG,
                                          "i_intDeviceID = " + IStr(i_intDeviceID) +
                                          ", i_strLockID = '" + i_strLockID + "'",
                                          strFunctionName,
                                          gInheco_ODTC_intTraceLevel,
                                          gInheco_ODTC_strModuleName);

        if(gInheco_ODTC_blnSimulationMode == ASWGLOBAL::BOOL::TRUE)
        {
          Hamilton_DriverTools::StatusTrace(Hamilton_DriverTools::ACTION::COMPLETE,
                                            TRACE_LEVEL_DEBUG,
                                            strFunctionName,
                                            "Simulated",
                                            gInheco_ODTC_intTraceLevel,
                                            gInheco_ODTC_strModuleName);
          return (ASWGLOBAL::BOOL::TRUE);
        }

        onerror goto DLL_ERROR;
        gInheco_ODTC_arrhdlCriticalSections[i_intDeviceID].WaitEvent(hslInfinite);
        objDevice = gInheco_ODTC_arrobjDevices.ElementAt(i_intDeviceID);
        if(!objDevice.Initialize(i_strLockID,
                                 o_intSiLAReturnValue,
                                 o_strSiLAMessage))
        {
          gInheco_ODTC_arrhdlCriticalSections[i_intDeviceID].SetEvent();
          onerror goto 0;
          Hamilton_DriverTools::StatusTrace(Hamilton_DriverTools::ACTION::COMPLETE_WITH_ERROR,
                                            TRACE_LEVEL_RELEASE,
                                            "Failed to initialize device " + IStr(i_intDeviceID) + ", see logfile for details !",
                                            strFunctionName,
                                            gInheco_ODTC_intTraceLevel,
                                            gInheco_ODTC_strModuleName);
          return(ASWGLOBAL::BOOL::FALSE);
        }
        hdlDelay.SetTimer(2.0);
        hdlDelay.WaitTimer(hslFalse, hslFalse);

        if(!objDevice.SwitchDataEvents(i_strLockID,
                                       hslTrue,
                                       o_intSiLAReturnValue,
                                       o_strSiLAMessage))
        {
          gInheco_ODTC_arrhdlCriticalSections[i_intDeviceID].SetEvent();
          onerror goto 0;
          Hamilton_DriverTools::StatusTrace(Hamilton_DriverTools::ACTION::COMPLETE_WITH_ERROR,
                                            TRACE_LEVEL_RELEASE,
                                            "Failed to enable data events, see logfile for details !",
                                            strFunctionName,
                                            gInheco_ODTC_intTraceLevel,
                                            gInheco_ODTC_strModuleName);
          return(ASWGLOBAL::BOOL::FALSE);
        }
        gInheco_ODTC_arrhdlCriticalSections[i_intDeviceID].SetEvent();
        onerror goto 0;

        Hamilton_DriverTools::StatusTrace(Hamilton_DriverTools::ACTION::COMPLETE,
                                          TRACE_LEVEL_DEBUG,
                                          "o_intSiLAReturnValue = " + IStr(o_intSiLAReturnValue) +
                                          ", o_strSiLAMessage = '" + o_strSiLAMessage + "'",
                                          strFunctionName,
                                          gInheco_ODTC_intTraceLevel,
                                          gInheco_ODTC_strModuleName);
        return(ASWGLOBAL::BOOL::TRUE);

        DLL_ERROR:
        {
          gInheco_ODTC_arrhdlCriticalSections[i_intDeviceID].SetEvent();
          Hamilton_DriverTools::StatusTrace(Hamilton_DriverTools::ACTION::COMPLETE_WITH_ERROR,
                                            TRACE_LEVEL_RELEASE,
                                            "Unhandled exception in dll or dll missing!",
                                            strFunctionName,
                                            gInheco_ODTC_intTraceLevel,
                                            gInheco_ODTC_strModuleName);
          return(ASWGLOBAL::BOOL::FALSE);
        }
      } // Initialize

      //----------------------------------------------------------------------------------------------
      // function OpenDoor
      //----------------------------------------------------------------------------------------------
      function OpenDoor(variable i_intDeviceID,
                        variable i_strLockID,
                        variable &o_intSiLAReturnValue,
                        variable &o_strSiLAMessage) variable
      {
        object objDevice;
        variable strFunctionName("");
        o_strSiLAMessage="in Simulation";

        if(Hamilton_DriverTools::ExtractFunctionName(GetFunctionName(),
                                                     strFunctionName,
                                                     gInheco_ODTC_strModuleName) == ASWGLOBAL::BOOL::FALSE) return(ASWGLOBAL::BOOL::FALSE);

        if(Hamilton_DriverTools::CheckIntegerRange(i_intDeviceID,
                                                   "i_intDeviceID",
                                                   1,
                                                   MAX_DEVICES,
                                                   strFunctionName,
                                                   gInheco_ODTC_strModuleName) == ASWGLOBAL::BOOL::FALSE) return(ASWGLOBAL::BOOL::FALSE);

        if(Hamilton_DriverTools::CheckString(i_strLockID,
                                             "i_strLockID",
                                             strFunctionName,
                                             gInheco_ODTC_strModuleName) == ASWGLOBAL::BOOL::FALSE) return(ASWGLOBAL::BOOL::FALSE);

        Hamilton_DriverTools::StatusTrace(Hamilton_DriverTools::ACTION::START,
                                          TRACE_LEVEL_DEBUG,
                                          "i_intDeviceID = " + IStr(i_intDeviceID) +
                                          ", i_strLockID = '" + i_strLockID + "'",
                                          strFunctionName,
                                          gInheco_ODTC_intTraceLevel,
                                          gInheco_ODTC_strModuleName);

        if(gInheco_ODTC_blnSimulationMode == ASWGLOBAL::BOOL::TRUE)
        {
          Hamilton_DriverTools::StatusTrace(Hamilton_DriverTools::ACTION::COMPLETE,
                                            TRACE_LEVEL_DEBUG,
                                            strFunctionName,
                                            "Simulated",
                                            gInheco_ODTC_intTraceLevel,
                                            gInheco_ODTC_strModuleName);
          return (ASWGLOBAL::BOOL::TRUE);
        }

        onerror goto DLL_ERROR;
        gInheco_ODTC_arrhdlCriticalSections[i_intDeviceID].WaitEvent(hslInfinite);
        objDevice = gInheco_ODTC_arrobjDevices.ElementAt(i_intDeviceID);
        if(!objDevice.OpenDoor(i_strLockID,
                               o_intSiLAReturnValue,
                               o_strSiLAMessage))
        {
          gInheco_ODTC_arrhdlCriticalSections[i_intDeviceID].SetEvent();
          onerror goto 0;
          Hamilton_DriverTools::StatusTrace(Hamilton_DriverTools::ACTION::COMPLETE_WITH_ERROR,
                                            TRACE_LEVEL_RELEASE,
                                            "Failed to open door on device " + IStr(i_intDeviceID) + ", see logfile for details !",
                                            strFunctionName,
                                            gInheco_ODTC_intTraceLevel,
                                            gInheco_ODTC_strModuleName);
          return(ASWGLOBAL::BOOL::FALSE);
        }
        gInheco_ODTC_arrhdlCriticalSections[i_intDeviceID].SetEvent();
        onerror goto 0;

        Hamilton_DriverTools::StatusTrace(Hamilton_DriverTools::ACTION::COMPLETE,
                                          TRACE_LEVEL_DEBUG,
                                          "o_intSiLAReturnValue = " + IStr(o_intSiLAReturnValue) +
                                          ", o_strSiLAMessage = '" + o_strSiLAMessage + "'",
                                          strFunctionName,
                                          gInheco_ODTC_intTraceLevel,
                                          gInheco_ODTC_strModuleName);
        return(ASWGLOBAL::BOOL::TRUE);

        DLL_ERROR:
        {
          gInheco_ODTC_arrhdlCriticalSections[i_intDeviceID].SetEvent();
          Hamilton_DriverTools::StatusTrace(Hamilton_DriverTools::ACTION::COMPLETE_WITH_ERROR,
                                            TRACE_LEVEL_RELEASE,
                                            "Unhandled exception in dll or dll missing!",
                                            strFunctionName,
                                            gInheco_ODTC_intTraceLevel,
                                            gInheco_ODTC_strModuleName);
          return(ASWGLOBAL::BOOL::FALSE);
        }
      } // OpenDoor

      //----------------------------------------------------------------------------------------------
      // function CloseDoor
      //----------------------------------------------------------------------------------------------
      function CloseDoor(variable i_intDeviceID,
                         variable i_strLockID,
                         variable &o_intSiLAReturnValue,
                         variable &o_strSiLAMessage) variable
      {
        object objDevice;
        variable strFunctionName("");
        o_strSiLAMessage="in Simulation";

        if(Hamilton_DriverTools::ExtractFunctionName(GetFunctionName(),
                                                     strFunctionName,
                                                     gInheco_ODTC_strModuleName) == ASWGLOBAL::BOOL::FALSE) return(ASWGLOBAL::BOOL::FALSE);

        if(Hamilton_DriverTools::CheckIntegerRange(i_intDeviceID,
                                                   "i_intDeviceID",
                                                   1,
                                                   MAX_DEVICES,
                                                   strFunctionName,
                                                   gInheco_ODTC_strModuleName) == ASWGLOBAL::BOOL::FALSE) return(ASWGLOBAL::BOOL::FALSE);

        if(Hamilton_DriverTools::CheckString(i_strLockID,
                                             "i_strLockID",
                                             strFunctionName,
                                             gInheco_ODTC_strModuleName) == ASWGLOBAL::BOOL::FALSE) return(ASWGLOBAL::BOOL::FALSE);

        Hamilton_DriverTools::StatusTrace(Hamilton_DriverTools::ACTION::START,
                                          TRACE_LEVEL_DEBUG,
                                          "i_intDeviceID = " + IStr(i_intDeviceID) +
                                          ", i_strLockID = '" + i_strLockID + "'",
                                          strFunctionName,
                                          gInheco_ODTC_intTraceLevel,
                                          gInheco_ODTC_strModuleName);

        if(gInheco_ODTC_blnSimulationMode == ASWGLOBAL::BOOL::TRUE)
        {
          Hamilton_DriverTools::StatusTrace(Hamilton_DriverTools::ACTION::COMPLETE,
                                            TRACE_LEVEL_DEBUG,
                                            strFunctionName,
                                            "Simulated",
                                            gInheco_ODTC_intTraceLevel,
                                            gInheco_ODTC_strModuleName);
          return (ASWGLOBAL::BOOL::TRUE);
        }

        onerror goto DLL_ERROR;
        gInheco_ODTC_arrhdlCriticalSections[i_intDeviceID].WaitEvent(hslInfinite);
        objDevice = gInheco_ODTC_arrobjDevices.ElementAt(i_intDeviceID);
        if(!objDevice.CloseDoor(i_strLockID,
                                o_intSiLAReturnValue,
                                o_strSiLAMessage))
        {
          gInheco_ODTC_arrhdlCriticalSections[i_intDeviceID].SetEvent();
          onerror goto 0;
          Hamilton_DriverTools::StatusTrace(Hamilton_DriverTools::ACTION::COMPLETE_WITH_ERROR,
                                            TRACE_LEVEL_RELEASE,
                                            "Failed to close door on device " + IStr(i_intDeviceID) + ", see logfile for details !",
                                            strFunctionName,
                                            gInheco_ODTC_intTraceLevel,
                                            gInheco_ODTC_strModuleName);
          return(ASWGLOBAL::BOOL::FALSE);
        }
        gInheco_ODTC_arrhdlCriticalSections[i_intDeviceID].SetEvent();
        onerror goto 0;

        Hamilton_DriverTools::StatusTrace(Hamilton_DriverTools::ACTION::COMPLETE,
                                          TRACE_LEVEL_DEBUG,
                                          "o_intSiLAReturnValue = " + IStr(o_intSiLAReturnValue) +
                                          ", o_strSiLAMessage = '" + o_strSiLAMessage + "'",
                                          strFunctionName,
                                          gInheco_ODTC_intTraceLevel,
                                          gInheco_ODTC_strModuleName);
        return(ASWGLOBAL::BOOL::TRUE);

        DLL_ERROR:
        {
          gInheco_ODTC_arrhdlCriticalSections[i_intDeviceID].SetEvent();
          Hamilton_DriverTools::StatusTrace(Hamilton_DriverTools::ACTION::COMPLETE_WITH_ERROR,
                                            TRACE_LEVEL_RELEASE,
                                            "Unhandled exception in dll or dll missing!",
                                            strFunctionName,
                                            gInheco_ODTC_intTraceLevel,
                                            gInheco_ODTC_strModuleName);
          return(ASWGLOBAL::BOOL::FALSE);
        }
      } // CloseDoor

      //----------------------------------------------------------------------------------------------
      // function DownloadProtocol
      //----------------------------------------------------------------------------------------------
      function DownloadProtocol(variable i_intDeviceID,
                                variable i_strLockID,
                                variable i_strProtocolFile,
                                variable& o_intSiLAReturnValue,
                                variable& o_strSiLAMessage) variable
      {
        file hdlXmlFile;
        variable strXMLData(""), strXMLDataAll("");
        object objDevice;
        timer hdlDelay;
        variable strFunctionName("");

        if(Hamilton_DriverTools::ExtractFunctionName(GetFunctionName(),
                                                     strFunctionName,
                                                     gInheco_ODTC_strModuleName) == ASWGLOBAL::BOOL::FALSE) return(ASWGLOBAL::BOOL::FALSE);

        if(Hamilton_DriverTools::CheckIntegerRange(i_intDeviceID,
                                                   "i_intDeviceID",
                                                   1,
                                                   MAX_DEVICES,
                                                   strFunctionName,
                                                   gInheco_ODTC_strModuleName) == ASWGLOBAL::BOOL::FALSE) return(ASWGLOBAL::BOOL::FALSE);

        if(Hamilton_DriverTools::CheckString(i_strLockID,
                                             "i_strLockID",
                                             strFunctionName,
                                             gInheco_ODTC_strModuleName) == ASWGLOBAL::BOOL::FALSE) return(ASWGLOBAL::BOOL::FALSE);

        if(Hamilton_DriverTools::CheckString(i_strProtocolFile,
                                             "i_strProtocolFile",
                                             strFunctionName,
                                             gInheco_ODTC_strModuleName) == ASWGLOBAL::BOOL::FALSE) return(ASWGLOBAL::BOOL::FALSE);

        Hamilton_DriverTools::StatusTrace(Hamilton_DriverTools::ACTION::START,
                                          TRACE_LEVEL_DEBUG,
                                          "i_intDeviceID = " + IStr(i_intDeviceID) +
                                          ", i_strLockID = '" + i_strLockID + "'" +
                                          ", i_strProtocolFile = '" + i_strProtocolFile + "'",
                                          strFunctionName,
                                          gInheco_ODTC_intTraceLevel,
                                          gInheco_ODTC_strModuleName);

        if(gInheco_ODTC_blnSimulationMode == ASWGLOBAL::BOOL::TRUE)
        {
          Hamilton_DriverTools::StatusTrace(Hamilton_DriverTools::ACTION::COMPLETE,
                                            TRACE_LEVEL_DEBUG,
                                            strFunctionName,
                                            "Simulated",
                                            gInheco_ODTC_intTraceLevel,
                                            gInheco_ODTC_strModuleName);
          return (ASWGLOBAL::BOOL::TRUE);
        }

        onerror goto DLL_ERROR;
        gInheco_ODTC_arrhdlCriticalSections[i_intDeviceID].WaitEvent(hslInfinite);
        objDevice = gInheco_ODTC_arrobjDevices.ElementAt(i_intDeviceID);

        if(i_strProtocolFile != "")
        {
          hdlXmlFile.AddField(1, strXMLData, hslString);
          hdlXmlFile.SetDelimiter(hslAsciiText);
          if(hdlXmlFile.Open(i_strProtocolFile, hslRead) == 0)
          {
            o_strSiLAMessage = "Cannot find File '" + i_strProtocolFile + "'";
            o_intSiLAReturnValue = -99999;
            Hamilton_DriverTools::StatusTrace(Hamilton_DriverTools::ACTION::COMPLETE_WITH_ERROR,
                                              TRACE_LEVEL_RELEASE,
                                              o_strSiLAMessage,
                                              strFunctionName,
                                              gInheco_ODTC_intTraceLevel,
                                              gInheco_ODTC_strModuleName);
            return(ASWGLOBAL::BOOL::FALSE);
          }

          while(!hdlXmlFile.Eof())
          {
            if(hdlXmlFile.ReadRecord() == 0)
            {
              o_strSiLAMessage = "Cannot read from File '" + i_strProtocolFile + "'";
              o_intSiLAReturnValue = -99998;
              Hamilton_DriverTools::StatusTrace(Hamilton_DriverTools::ACTION::COMPLETE_WITH_ERROR,
                                                TRACE_LEVEL_RELEASE,
                                                o_strSiLAMessage,
                                                strFunctionName,
                                                gInheco_ODTC_intTraceLevel,
                                                gInheco_ODTC_strModuleName);
              return(ASWGLOBAL::BOOL::FALSE);
            }

            strXMLDataAll = strXMLDataAll + strXMLData;
          }

          if(0 != hdlXmlFile.Close())
          {
            o_strSiLAMessage="File Close error for File '" + i_strProtocolFile + "'";
            o_intSiLAReturnValue=-99997;
            Hamilton_DriverTools::StatusTrace(Hamilton_DriverTools::ACTION::COMPLETE_WITH_ERROR,
                                              TRACE_LEVEL_RELEASE,
                                              o_strSiLAMessage,
                                              strFunctionName,
                                              gInheco_ODTC_intTraceLevel,
                                              gInheco_ODTC_strModuleName);
            return(ASWGLOBAL::BOOL::FALSE);
          }

          hdlXmlFile.RemoveFields();

          if(!objDevice.SetMethod(i_strLockID,
                                  strXMLDataAll,
                                  o_intSiLAReturnValue,
                                  o_strSiLAMessage))
          {
            gInheco_ODTC_arrhdlCriticalSections[i_intDeviceID].SetEvent();
            onerror goto 0;
            Hamilton_DriverTools::StatusTrace(Hamilton_DriverTools::ACTION::COMPLETE_WITH_ERROR,
                                              TRACE_LEVEL_RELEASE,
                                              "Failed to set method on device " + IStr(i_intDeviceID) + ", see logfile for details !",
                                              strFunctionName,
                                              gInheco_ODTC_intTraceLevel,
                                              gInheco_ODTC_strModuleName);
            return(ASWGLOBAL::BOOL::FALSE);
          }
          onerror goto 0;
        }
        else
        {
          Hamilton_DriverTools::StatusTrace(Hamilton_DriverTools::ACTION::PROGRESS,
                                            TRACE_LEVEL_DEBUG,
                                            "No XML file provided - will use the script stored on device.",
                                            strFunctionName,
                                            gInheco_ODTC_intTraceLevel,
                                            gInheco_ODTC_strModuleName);
        }

        gInheco_ODTC_arrhdlCriticalSections[i_intDeviceID].SetEvent();

        hdlDelay.SetTimer(2.0);
        hdlDelay.WaitTimer(hslFalse, hslFalse);

        Hamilton_DriverTools::StatusTrace(Hamilton_DriverTools::ACTION::COMPLETE,
                                          TRACE_LEVEL_DEBUG,
                                          "o_intSiLAReturnValue = " + IStr(o_intSiLAReturnValue) +
                                          ", o_strSiLAMessage = '" + o_strSiLAMessage + "'",
                                          strFunctionName,
                                          gInheco_ODTC_intTraceLevel,
                                          gInheco_ODTC_strModuleName);
        return(ASWGLOBAL::BOOL::TRUE);

        DLL_ERROR:
        {
          gInheco_ODTC_arrhdlCriticalSections[i_intDeviceID].SetEvent();
          Hamilton_DriverTools::StatusTrace(Hamilton_DriverTools::ACTION::COMPLETE_WITH_ERROR,
                                            TRACE_LEVEL_RELEASE,
                                            "Unhandled exception in dll or dll missing!",
                                            strFunctionName,
                                            gInheco_ODTC_intTraceLevel,
                                            gInheco_ODTC_strModuleName);
          return(ASWGLOBAL::BOOL::FALSE);
        }
      } // StartExecuteProtocol

      //----------------------------------------------------------------------------------------------
      // function ExecuteMethod
      //----------------------------------------------------------------------------------------------
      function ExecuteMethod(variable i_intDeviceID,
                             variable i_strLockID,
                             variable i_strMethodName, 
                             variable i_intPriority,
                             variable& o_intDuration,
                             variable& o_intRequestId,
                             variable& o_intSiLAReturnValue,
                             variable& o_strSiLAMessage) variable
      {
        object objDevice;
        variable strFunctionName("");
        o_strSiLAMessage="in Simulation";

        if(Hamilton_DriverTools::ExtractFunctionName(GetFunctionName(),
                                                     strFunctionName,
                                                     gInheco_ODTC_strModuleName) == ASWGLOBAL::BOOL::FALSE) return(ASWGLOBAL::BOOL::FALSE);

        if(Hamilton_DriverTools::CheckIntegerRange(i_intDeviceID,
                                                   "i_intDeviceID",
                                                   1,
                                                   MAX_DEVICES,
                                                   strFunctionName,
                                                   gInheco_ODTC_strModuleName) == ASWGLOBAL::BOOL::FALSE) return(ASWGLOBAL::BOOL::FALSE);

        if(Hamilton_DriverTools::CheckString(i_strLockID,
                                           "i_strLockID",
                                           strFunctionName,
                                           gInheco_ODTC_strModuleName) == ASWGLOBAL::BOOL::FALSE) return(ASWGLOBAL::BOOL::FALSE);
    
        if(Hamilton_DriverTools::CheckString(i_strMethodName,
                                           "i_strMethodName",
                                           strFunctionName,
                                           gInheco_ODTC_strModuleName) == ASWGLOBAL::BOOL::FALSE) return(ASWGLOBAL::BOOL::FALSE);

        if(Hamilton_DriverTools::CheckIntegerRange(i_intPriority,
                                           "i_intPriority",
                                           0,
                                           10001,
                                           strFunctionName,
                                           gInheco_ODTC_strModuleName) == ASWGLOBAL::BOOL::FALSE) return(ASWGLOBAL::BOOL::FALSE);

        Hamilton_DriverTools::StatusTrace(Hamilton_DriverTools::ACTION::START,
                                          TRACE_LEVEL_DEBUG,
                                          "i_intDeviceID = " + IStr(i_intDeviceID) +
                                          ", i_strLockID = '" + i_strLockID + "'" +
                                          ", i_strMethodName = '" + i_strMethodName + "'" +
                                          ", i_intPriority = " + IStr(i_intPriority),
                                          strFunctionName,
                                          gInheco_ODTC_intTraceLevel,
                                          gInheco_ODTC_strModuleName);

        if(gInheco_ODTC_blnSimulationMode == ASWGLOBAL::BOOL::TRUE)
        {
          Hamilton_DriverTools::StatusTrace(Hamilton_DriverTools::ACTION::COMPLETE,
                                            TRACE_LEVEL_DEBUG,
                                            strFunctionName,
                                            "Simulated",
                                        
                                            gInheco_ODTC_intTraceLevel,
                                            gInheco_ODTC_strModuleName);
          return (ASWGLOBAL::BOOL::TRUE);
        }

        onerror goto DLL_ERROR;
        gInheco_ODTC_arrhdlCriticalSections[i_intDeviceID].WaitEvent(hslInfinite);
        objDevice = gInheco_ODTC_arrobjDevices.ElementAt(i_intDeviceID);
        if(!objDevice.ExecuteMethod(i_strLockID,
                                    i_strMethodName, 
                                    i_intPriority,
                                    o_intRequestId,
                                    o_intSiLAReturnValue,
                                    o_strSiLAMessage,
                                    o_intDuration))
        {
          gInheco_ODTC_arrhdlCriticalSections[i_intDeviceID].SetEvent();
          onerror goto 0;
          Hamilton_DriverTools::StatusTrace(Hamilton_DriverTools::ACTION::COMPLETE_WITH_ERROR,
                                            TRACE_LEVEL_RELEASE,
                                            "Failed to execute method from device " + IStr(i_intDeviceID) + ", see logfile for details !",
                                            strFunctionName,
                                            gInheco_ODTC_intTraceLevel,
                                            gInheco_ODTC_strModuleName);
          return(ASWGLOBAL::BOOL::FALSE);
        }
        gInheco_ODTC_arrhdlCriticalSections[i_intDeviceID].SetEvent();
        onerror goto 0;

        Hamilton_DriverTools::StatusTrace(Hamilton_DriverTools::ACTION::COMPLETE,
                                          TRACE_LEVEL_DEBUG,
                                          "o_intDuration = " + IStr(o_intDuration) +
                                          ", o_intRequestId = " + IStr(o_intRequestId) +
                                          ", o_intSiLAReturnValue = " + IStr(o_intSiLAReturnValue) +
                                          ", o_strSiLAMessage = '" + o_strSiLAMessage + "'",
                                          strFunctionName,
                                          gInheco_ODTC_intTraceLevel,
                                          gInheco_ODTC_strModuleName);
        return(ASWGLOBAL::BOOL::TRUE);

        DLL_ERROR:
        {
          gInheco_ODTC_arrhdlCriticalSections[i_intDeviceID].SetEvent();
          Hamilton_DriverTools::StatusTrace(Hamilton_DriverTools::ACTION::COMPLETE_WITH_ERROR,
                                            TRACE_LEVEL_RELEASE,
                                            "Unhandled exception in dll or dll missing!",
                                            strFunctionName,
                                            gInheco_ODTC_intTraceLevel,
                                            gInheco_ODTC_strModuleName);
          return(ASWGLOBAL::BOOL::FALSE);
        }
      } // ExecuteMethod

      //----------------------------------------------------------------------------------------------
      // function WaitForEndOfExecuteMethod
      //----------------------------------------------------------------------------------------------
      function WaitForEndOfExecuteMethod(variable i_intDeviceID,
                                         variable i_intTimeOut,
                                         variable i_intRequestId,
                                         variable& o_intSiLAReturnValue,
                                         variable& o_strSiLAMessage) variable
      {
        object objDevice;
        variable strFunctionName("");
        o_strSiLAMessage="in Simulation";

        if(Hamilton_DriverTools::ExtractFunctionName(GetFunctionName(),
                                                     strFunctionName,
                                                     gInheco_ODTC_strModuleName) == ASWGLOBAL::BOOL::FALSE) return(ASWGLOBAL::BOOL::FALSE);

        if(Hamilton_DriverTools::CheckIntegerRange(i_intDeviceID,
                                                   "i_intDeviceID",
                                                   1,
                                                   MAX_DEVICES,
                                                   strFunctionName,
                                                   gInheco_ODTC_strModuleName) == ASWGLOBAL::BOOL::FALSE) return(ASWGLOBAL::BOOL::FALSE);

        if(Hamilton_DriverTools::CheckIntegerRange(i_intTimeOut,
                                                   "i_intTimeOut",
                                                   0,
                                                   MAX_INT,
                                                   strFunctionName,
                                                   gInheco_ODTC_strModuleName) == ASWGLOBAL::BOOL::FALSE) return(ASWGLOBAL::BOOL::FALSE);

        if(Hamilton_DriverTools::CheckIntegerRange(i_intRequestId,
                                                   "i_intRequestId",
                                                   0,
                                                   MAX_INT,
                                                   strFunctionName,
                                                   gInheco_ODTC_strModuleName) == ASWGLOBAL::BOOL::FALSE) return(ASWGLOBAL::BOOL::FALSE);

        Hamilton_DriverTools::StatusTrace(Hamilton_DriverTools::ACTION::START,
                                          TRACE_LEVEL_DEBUG,
                                          "i_intDeviceID = " + IStr(i_intDeviceID) +
                                          ", i_intTimeOut = " + IStr(i_intTimeOut) +
                                          ", i_intRequestId = " + IStr(i_intRequestId),
                                          strFunctionName,
                                          gInheco_ODTC_intTraceLevel,
                                          gInheco_ODTC_strModuleName);

        if(gInheco_ODTC_blnSimulationMode == ASWGLOBAL::BOOL::TRUE)
        {
          Hamilton_DriverTools::StatusTrace(Hamilton_DriverTools::ACTION::COMPLETE,
                                            TRACE_LEVEL_DEBUG,
                                            strFunctionName,
                                            "Simulated",
                                            gInheco_ODTC_intTraceLevel,
                                            gInheco_ODTC_strModuleName);
          return (ASWGLOBAL::BOOL::TRUE);
        }

        onerror goto DLL_ERROR;
        gInheco_ODTC_arrhdlCriticalSections[i_intDeviceID].WaitEvent(hslInfinite);
        objDevice = gInheco_ODTC_arrobjDevices.ElementAt(i_intDeviceID);
        if(!objDevice.WaitForEndOfExecuteMethod(i_intTimeOut,
                                                i_intRequestId,
                                                o_intSiLAReturnValue,
                                                o_strSiLAMessage))
        {
          gInheco_ODTC_arrhdlCriticalSections[i_intDeviceID].SetEvent();
          onerror goto 0;
          Hamilton_DriverTools::StatusTrace(Hamilton_DriverTools::ACTION::COMPLETE_WITH_ERROR,
                                            TRACE_LEVEL_RELEASE,
                                            "Failed to wait for end of execute method from device " + IStr(i_intDeviceID) + ", see logfile for details !",
                                            strFunctionName,
                                            gInheco_ODTC_intTraceLevel,
                                            gInheco_ODTC_strModuleName);
          return(ASWGLOBAL::BOOL::FALSE);
        }
        gInheco_ODTC_arrhdlCriticalSections[i_intDeviceID].SetEvent();
        onerror goto 0;

        Hamilton_DriverTools::StatusTrace(Hamilton_DriverTools::ACTION::COMPLETE,
                                          TRACE_LEVEL_DEBUG,
                                          "o_intSiLAReturnValue = " + IStr(o_intSiLAReturnValue) +
                                          ", o_strSiLAMessage = '" + o_strSiLAMessage + "'",
                                          strFunctionName,
                                          gInheco_ODTC_intTraceLevel,
                                          gInheco_ODTC_strModuleName);
        return(ASWGLOBAL::BOOL::TRUE);

        DLL_ERROR:
        {
          gInheco_ODTC_arrhdlCriticalSections[i_intDeviceID].SetEvent();
          Hamilton_DriverTools::StatusTrace(Hamilton_DriverTools::ACTION::COMPLETE_WITH_ERROR,
                                            TRACE_LEVEL_RELEASE,
                                            "Unhandled exception in dll or dll missing!",
                                            strFunctionName,
                                            gInheco_ODTC_intTraceLevel,
                                            gInheco_ODTC_strModuleName);
          return(ASWGLOBAL::BOOL::FALSE);
        }
      } // WaitForEndOfExecuteMethod

      //----------------------------------------------------------------------------------------------
      // function StopMethod
      //----------------------------------------------------------------------------------------------
      function StopMethod(variable i_intDeviceID,
                          variable i_strLockID,
                          variable& o_intSiLAReturnValue,
                          variable& o_strSiLAMessage) variable
      {
        object objDevice;
        variable strFunctionName("");
        o_strSiLAMessage="in Simulation";

        if(Hamilton_DriverTools::ExtractFunctionName(GetFunctionName(),
                                                     strFunctionName,
                                                     gInheco_ODTC_strModuleName) == ASWGLOBAL::BOOL::FALSE) return(ASWGLOBAL::BOOL::FALSE);

        if(Hamilton_DriverTools::CheckIntegerRange(i_intDeviceID,
                                                   "i_intDeviceID",
                                                   1,
                                                   MAX_DEVICES,
                                                   strFunctionName,
                                                   gInheco_ODTC_strModuleName) == ASWGLOBAL::BOOL::FALSE) return(ASWGLOBAL::BOOL::FALSE);

        if(Hamilton_DriverTools::CheckString(i_strLockID,
                                             "i_strLockID",
                                             strFunctionName,
                                             gInheco_ODTC_strModuleName) == ASWGLOBAL::BOOL::FALSE) return(ASWGLOBAL::BOOL::FALSE);

        Hamilton_DriverTools::StatusTrace(Hamilton_DriverTools::ACTION::START,
                                          TRACE_LEVEL_DEBUG,
                                          "i_intDeviceID = " + IStr(i_intDeviceID) +
                                          ", i_strLockID = '" + i_strLockID + "'",
                                          strFunctionName,
                                          gInheco_ODTC_intTraceLevel,
                                          gInheco_ODTC_strModuleName);

        if(gInheco_ODTC_blnSimulationMode == ASWGLOBAL::BOOL::TRUE)
        {
          Hamilton_DriverTools::StatusTrace(Hamilton_DriverTools::ACTION::COMPLETE,
                                            TRACE_LEVEL_DEBUG,
                                            strFunctionName,
                                            "Simulated",
                                            gInheco_ODTC_intTraceLevel,
                                            gInheco_ODTC_strModuleName);
          return (ASWGLOBAL::BOOL::TRUE);
        }

        onerror goto DLL_ERROR;
        gInheco_ODTC_arrhdlCriticalSections[i_intDeviceID].WaitEvent(hslInfinite);
        objDevice = gInheco_ODTC_arrobjDevices.ElementAt(i_intDeviceID);
        if(!objDevice.StopMethod(i_strLockID,
                                 o_intSiLAReturnValue,
                                 o_strSiLAMessage))
        {
          gInheco_ODTC_arrhdlCriticalSections[i_intDeviceID].SetEvent();
          onerror goto 0;
          Hamilton_DriverTools::StatusTrace(Hamilton_DriverTools::ACTION::COMPLETE_WITH_ERROR,
                                            TRACE_LEVEL_RELEASE,
                                            "Failed to stop method on device " + IStr(i_intDeviceID) + ", see logfile for details !",
                                            strFunctionName,
                                            gInheco_ODTC_intTraceLevel,
                                            gInheco_ODTC_strModuleName);
          return(ASWGLOBAL::BOOL::FALSE);
        }
        gInheco_ODTC_arrhdlCriticalSections[i_intDeviceID].SetEvent();
        onerror goto 0;

        Hamilton_DriverTools::StatusTrace(Hamilton_DriverTools::ACTION::COMPLETE,
                                          TRACE_LEVEL_DEBUG,
                                          "o_intSiLAReturnValue = " + IStr(o_intSiLAReturnValue) +
                                          ", o_strSiLAMessage = '" + o_strSiLAMessage + "'",
                                          strFunctionName,
                                          gInheco_ODTC_intTraceLevel,
                                          gInheco_ODTC_strModuleName);
        return(ASWGLOBAL::BOOL::TRUE);

        DLL_ERROR:
        {
          gInheco_ODTC_arrhdlCriticalSections[i_intDeviceID].SetEvent();
          Hamilton_DriverTools::StatusTrace(Hamilton_DriverTools::ACTION::COMPLETE_WITH_ERROR,
                                            TRACE_LEVEL_RELEASE,
                                            "Unhandled exception in dll or dll missing!",
                                            strFunctionName,
                                            gInheco_ODTC_intTraceLevel,
                                            gInheco_ODTC_strModuleName);
          return(ASWGLOBAL::BOOL::FALSE);
        }
      } // StopMethod

      //----------------------------------------------------------------------------------------------
      // function Abort
      //----------------------------------------------------------------------------------------------
      function Abort(variable i_intDeviceID,
                     variable i_strLockID,
                     variable& o_intSiLAReturnValue,
                     variable& o_strSiLAMessage) variable
      {
        object objDevice;
        variable strFunctionName("");
        o_strSiLAMessage="in Simulation";

        if(Hamilton_DriverTools::ExtractFunctionName(GetFunctionName(),
                                                     strFunctionName,
                                                     gInheco_ODTC_strModuleName) == ASWGLOBAL::BOOL::FALSE) return(ASWGLOBAL::BOOL::FALSE);

        if(Hamilton_DriverTools::CheckIntegerRange(i_intDeviceID,
                                                   "i_intDeviceID",
                                                   1,
                                                   MAX_DEVICES,
                                                   strFunctionName,
                                                   gInheco_ODTC_strModuleName) == ASWGLOBAL::BOOL::FALSE) return(ASWGLOBAL::BOOL::FALSE);

        if(Hamilton_DriverTools::CheckString(i_strLockID,
                                             "i_strLockID",
                                             strFunctionName,
                                             gInheco_ODTC_strModuleName) == ASWGLOBAL::BOOL::FALSE) return(ASWGLOBAL::BOOL::FALSE);

        Hamilton_DriverTools::StatusTrace(Hamilton_DriverTools::ACTION::START,
                                          TRACE_LEVEL_DEBUG,
                                          "i_intDeviceID = " + IStr(i_intDeviceID) +
                                          ", i_strLockID = '" + i_strLockID + "'",
                                          strFunctionName,
                                          gInheco_ODTC_intTraceLevel,
                                          gInheco_ODTC_strModuleName);

        if(gInheco_ODTC_blnSimulationMode == ASWGLOBAL::BOOL::TRUE)
        {
          Hamilton_DriverTools::StatusTrace(Hamilton_DriverTools::ACTION::COMPLETE,
                                            TRACE_LEVEL_DEBUG,
                                            strFunctionName,
                                            "Simulated",
                                            gInheco_ODTC_intTraceLevel,
                                            gInheco_ODTC_strModuleName);
          return (ASWGLOBAL::BOOL::TRUE);
        }

        onerror goto DLL_ERROR;
        gInheco_ODTC_arrhdlCriticalSections[i_intDeviceID].WaitEvent(hslInfinite);
        objDevice = gInheco_ODTC_arrobjDevices.ElementAt(i_intDeviceID);
        if(!objDevice.Abort(i_strLockID,
                            o_intSiLAReturnValue,
                            o_strSiLAMessage))
        {
          gInheco_ODTC_arrhdlCriticalSections[i_intDeviceID].SetEvent();
          onerror goto 0;
          Hamilton_DriverTools::StatusTrace(Hamilton_DriverTools::ACTION::COMPLETE_WITH_ERROR,
                                            TRACE_LEVEL_RELEASE,
                                            "Failed to abort device " + IStr(i_intDeviceID) + ", see logfile for details !",
                                            strFunctionName,
                                            gInheco_ODTC_intTraceLevel,
                                            gInheco_ODTC_strModuleName);
          return(ASWGLOBAL::BOOL::FALSE);
        }
        gInheco_ODTC_arrhdlCriticalSections[i_intDeviceID].SetEvent();
        onerror goto 0;

        Hamilton_DriverTools::StatusTrace(Hamilton_DriverTools::ACTION::COMPLETE,
                                          TRACE_LEVEL_DEBUG,
                                          "o_intSiLAReturnValue = " + IStr(o_intSiLAReturnValue) +
                                          ", o_strSiLAMessage = '" + o_strSiLAMessage + "'",
                                          strFunctionName,
                                          gInheco_ODTC_intTraceLevel,
                                          gInheco_ODTC_strModuleName);
        return(ASWGLOBAL::BOOL::TRUE);

        DLL_ERROR:
        {
          gInheco_ODTC_arrhdlCriticalSections[i_intDeviceID].SetEvent();
          Hamilton_DriverTools::StatusTrace(Hamilton_DriverTools::ACTION::COMPLETE_WITH_ERROR,
                                            TRACE_LEVEL_RELEASE,
                                            "Unhandled exception in dll or dll missing!",
                                            strFunctionName,
                                            gInheco_ODTC_intTraceLevel,
                                            gInheco_ODTC_strModuleName);
          return(ASWGLOBAL::BOOL::FALSE);
        }
      } // Abort

      //----------------------------------------------------------------------------------------------
      // function GetStatus
      //----------------------------------------------------------------------------------------------
       function GetStatus(variable i_intDeviceID,
                          variable& o_strDeviceId, 
                          variable& o_strState,
                          variable& o_blnLocked, 
                          variable& o_strPMSId, 
                          variable& o_strCurrentTime,
                          variable& o_intSiLAReturnValue,
                          variable& o_strSiLAMessage) variable
      {
        object objDevice;
        variable strFunctionName("");
        o_strSiLAMessage="in Simulation";

        if(Hamilton_DriverTools::ExtractFunctionName(GetFunctionName(),
                                                     strFunctionName,
                                                     gInheco_ODTC_strModuleName) == ASWGLOBAL::BOOL::FALSE) return(ASWGLOBAL::BOOL::FALSE);

        if(Hamilton_DriverTools::CheckIntegerRange(i_intDeviceID,
                                                   "i_intDeviceID",
                                                   1,
                                                   MAX_DEVICES,
                                                   strFunctionName,
                                                   gInheco_ODTC_strModuleName) == ASWGLOBAL::BOOL::FALSE) return(ASWGLOBAL::BOOL::FALSE);

        Hamilton_DriverTools::StatusTrace(Hamilton_DriverTools::ACTION::START,
                                          TRACE_LEVEL_DEBUG,
                                          "i_intDeviceID = " + IStr(i_intDeviceID),
                                          strFunctionName,
                                          gInheco_ODTC_intTraceLevel,
                                          gInheco_ODTC_strModuleName);

        if(gInheco_ODTC_blnSimulationMode == ASWGLOBAL::BOOL::TRUE)
        {
          Hamilton_DriverTools::StatusTrace(Hamilton_DriverTools::ACTION::COMPLETE,
                                            TRACE_LEVEL_DEBUG,
                                            strFunctionName,
                                            "Simulated",
                                            gInheco_ODTC_intTraceLevel,
                                            gInheco_ODTC_strModuleName);
          return (ASWGLOBAL::BOOL::TRUE);
        }

        onerror goto DLL_ERROR;
        gInheco_ODTC_arrhdlCriticalSections[i_intDeviceID].WaitEvent(hslInfinite);
        objDevice = gInheco_ODTC_arrobjDevices.ElementAt(i_intDeviceID);
        if(!objDevice.GetStatus(o_strDeviceId,
                                o_strState,
                                o_blnLocked,
                                o_strPMSId,
                                o_strCurrentTime,
                                o_intSiLAReturnValue,
                                o_strSiLAMessage))
        {
          gInheco_ODTC_arrhdlCriticalSections[i_intDeviceID].SetEvent();
          onerror goto 0;
          Hamilton_DriverTools::StatusTrace(Hamilton_DriverTools::ACTION::COMPLETE_WITH_ERROR,
                                            TRACE_LEVEL_RELEASE,
                                            "Failed to get status from device " + IStr(i_intDeviceID) + ", see logfile for details !",
                                            strFunctionName,
                                            gInheco_ODTC_intTraceLevel,
                                            gInheco_ODTC_strModuleName);
          return(ASWGLOBAL::BOOL::FALSE);
        }
        gInheco_ODTC_arrhdlCriticalSections[i_intDeviceID].SetEvent();
        onerror goto 0;

        if(o_blnLocked == 0)
          o_blnLocked=ASWGLOBAL::BOOL::FALSE;
        else
          o_blnLocked=ASWGLOBAL::BOOL::TRUE;

        Hamilton_DriverTools::StatusTrace(Hamilton_DriverTools::ACTION::COMPLETE,
                                          TRACE_LEVEL_DEBUG,
                                          "o_strDeviceId = '" + o_strDeviceId + "'"+
                                          ", o_strState = '" + o_strState + "'" +
                                          ", o_blnLocked = " + IStr(o_blnLocked) +
                                          ", o_strPMSId = '" + o_strPMSId + "'" +
                                          ", o_strCurrentTime = '" + o_strCurrentTime + "'" +
                                          ", o_intSiLAReturnValue = " + IStr(o_intSiLAReturnValue) +
                                          ", o_strSiLAMessage = '" + o_strSiLAMessage + "'",
                                          strFunctionName,
                                          gInheco_ODTC_intTraceLevel,
                                          gInheco_ODTC_strModuleName);
        return(ASWGLOBAL::BOOL::TRUE);

        DLL_ERROR:
        {
          gInheco_ODTC_arrhdlCriticalSections[i_intDeviceID].SetEvent();
          Hamilton_DriverTools::StatusTrace(Hamilton_DriverTools::ACTION::COMPLETE_WITH_ERROR,
                                            TRACE_LEVEL_RELEASE,
                                            "Unhandled exception in dll or dll missing!",
                                            strFunctionName,
                                            gInheco_ODTC_intTraceLevel,
                                            gInheco_ODTC_strModuleName);
          return(ASWGLOBAL::BOOL::FALSE);
        }
      } // GetStatus

      //----------------------------------------------------------------------------------------------
      // function SetTraceLevel
      //----------------------------------------------------------------------------------------------
      function SetTraceLevel(variable i_intTraceLevel) void
      {
        variable strFunctionName("");

        if(Hamilton_DriverTools::ExtractFunctionName(GetFunctionName(),
                                                     strFunctionName,
                                                     gInheco_ODTC_strModuleName) == ASWGLOBAL::BOOL::FALSE) return;

        if(Hamilton_DriverTools::CheckIntegerRange(i_intTraceLevel,
                                                   "i_intTraceLevel",
                                                   TRACE_LEVEL_RELEASE,
                                                   TRACE_LEVEL_DEBUG,
                                                   strFunctionName,
                                                   gInheco_ODTC_strModuleName) == ASWGLOBAL::BOOL::FALSE) return;

        if(!gInheco_ODTC_blnSemaphoreInitialized)
        {
          gInheco_ODTC_hdlMainCriticalSection.SetEvent();
          gInheco_ODTC_blnSemaphoreInitialized = hslTrue;
        }

        gInheco_ODTC_hdlMainCriticalSection.WaitEvent(hslInfinite);

        gInheco_ODTC_intTraceLevel = i_intTraceLevel;

        gInheco_ODTC_hdlMainCriticalSection.SetEvent();

        Hamilton_DriverTools::StatusTrace(Hamilton_DriverTools::ACTION::COMPLETE,
                                          TRACE_LEVEL_DEBUG,
                                          "",
                                          strFunctionName,
                                          gInheco_ODTC_intTraceLevel,
                                          gInheco_ODTC_strModuleName);
      } // SetTraceLevel

      //----------------------------------------------------------------------------------------------
      // function ReadActualTemperature
      //----------------------------------------------------------------------------------------------
      function ReadActualTemperature(variable i_intDeviceID,
                                     variable i_strLockID,
                                     variable& o_strTime,
                                     variable& o_arrfltActualTemperatures[],
                                     variable& o_arrstrActualTemperatureNames[],
                                     variable& o_intSiLAReturnValue,
                                     variable& o_strSiLAMessage) variable
      {
        object objDevice;
        variable strFunctionName("");
        o_strSiLAMessage = "in Simulation";

        if(Hamilton_DriverTools::ExtractFunctionName(GetFunctionName(),
                                                     strFunctionName,
                                                     gInheco_ODTC_strModuleName) == ASWGLOBAL::BOOL::FALSE) return(ASWGLOBAL::BOOL::FALSE);

        if(Hamilton_DriverTools::CheckIntegerRange(i_intDeviceID,
                                                   "i_intDeviceID",
                                                   1,
                                                   MAX_DEVICES,
                                                   strFunctionName,
                                                   gInheco_ODTC_strModuleName) == ASWGLOBAL::BOOL::FALSE) return(ASWGLOBAL::BOOL::FALSE);

        if(Hamilton_DriverTools::CheckString(i_strLockID,
                                             "i_strLockID",
                                             strFunctionName,
                                             gInheco_ODTC_strModuleName) == ASWGLOBAL::BOOL::FALSE) return(ASWGLOBAL::BOOL::FALSE);

        Hamilton_DriverTools::StatusTrace(Hamilton_DriverTools::ACTION::START,
                                          TRACE_LEVEL_DEBUG,
                                          "i_intDeviceID = " + IStr(i_intDeviceID) +
                                          ", i_strLockID = '" + i_strLockID + "'",
                                          strFunctionName,
                                          gInheco_ODTC_intTraceLevel,
                                          gInheco_ODTC_strModuleName);

        if(gInheco_ODTC_blnSimulationMode == ASWGLOBAL::BOOL::TRUE)
        {
          Hamilton_DriverTools::StatusTrace(Hamilton_DriverTools::ACTION::COMPLETE,
                                            TRACE_LEVEL_DEBUG,
                                            strFunctionName,
                                            "Simulated",
                                            gInheco_ODTC_intTraceLevel,
                                            gInheco_ODTC_strModuleName);
          return (ASWGLOBAL::BOOL::TRUE);
        }

        onerror goto DLL_ERROR;
        gInheco_ODTC_arrhdlCriticalSections[i_intDeviceID].WaitEvent(hslInfinite);
        objDevice = gInheco_ODTC_arrobjDevices.ElementAt(i_intDeviceID);
        if(!objDevice.ReadActualTemperature(i_strLockID,
                                            o_strTime,
                                            o_arrfltActualTemperatures,
                                            o_arrstrActualTemperatureNames,
                                            o_intSiLAReturnValue,
                                            o_strSiLAMessage))
        {
          gInheco_ODTC_arrhdlCriticalSections[i_intDeviceID].SetEvent();
          onerror goto 0;
          Hamilton_DriverTools::StatusTrace(Hamilton_DriverTools::ACTION::COMPLETE_WITH_ERROR,
                                            TRACE_LEVEL_RELEASE,
                                            "Failed to read actual temperature device " + IStr(i_intDeviceID) + ", see logfile for details !",
                                            strFunctionName,
                                            gInheco_ODTC_intTraceLevel,
                                            gInheco_ODTC_strModuleName);
          return(ASWGLOBAL::BOOL::FALSE);
        }
        gInheco_ODTC_arrhdlCriticalSections[i_intDeviceID].SetEvent();
        onerror goto 0;

        Hamilton_DriverTools::TraceArrayFaceToFace(Hamilton_DriverTools::ACTION::PROGRESS,
                                                   TRACE_LEVEL_DEBUG,
                                                   "",
                                                   o_arrstrActualTemperatureNames,
                                                   "",
                                                   o_arrfltActualTemperatures,
                                                   strFunctionName,
                                                   gInheco_ODTC_intTraceLevel,
                                                   gInheco_ODTC_strModuleName);

        Hamilton_DriverTools::StatusTrace(Hamilton_DriverTools::ACTION::COMPLETE,
                                          TRACE_LEVEL_DEBUG,
                                          "o_strTime = '" + o_strTime + "'" +
                                          ", o_intSiLAReturnValue = " + IStr(o_intSiLAReturnValue) +
                                          ", o_strSiLAMessage = '" + o_strSiLAMessage + "'",
                                          strFunctionName,
                                          gInheco_ODTC_intTraceLevel,
                                          gInheco_ODTC_strModuleName);
        return(ASWGLOBAL::BOOL::TRUE);

        DLL_ERROR:
        {
          gInheco_ODTC_arrhdlCriticalSections[i_intDeviceID].SetEvent();
          Hamilton_DriverTools::StatusTrace(Hamilton_DriverTools::ACTION::COMPLETE_WITH_ERROR,
                                            TRACE_LEVEL_RELEASE,
                                            "Unhandled exception in dll or dll missing!",
                                            strFunctionName,
                                            gInheco_ODTC_intTraceLevel,
                                            gInheco_ODTC_strModuleName);
          return(ASWGLOBAL::BOOL::FALSE);
        }
      } // ReadActualTemperature

      //----------------------------------------------------------------------------------------------
      // function Terminate
      //----------------------------------------------------------------------------------------------
      function Terminate(variable i_intDeviceID,
                         variable& o_strSiLAMessage) variable
      {
        object objDevice;
        variable strFunctionName("");
        o_strSiLAMessage="in Simulation";

        if(Hamilton_DriverTools::ExtractFunctionName(GetFunctionName(),
                                                     strFunctionName,
                                                     gInheco_ODTC_strModuleName) == ASWGLOBAL::BOOL::FALSE) return(ASWGLOBAL::BOOL::FALSE);

        if(Hamilton_DriverTools::CheckIntegerRange(i_intDeviceID,
                                                   "i_intDeviceID",
                                                   1,
                                                   MAX_DEVICES,
                                                   strFunctionName,
                                                   gInheco_ODTC_strModuleName) == ASWGLOBAL::BOOL::FALSE) return(ASWGLOBAL::BOOL::FALSE);

          Hamilton_DriverTools::StatusTrace(Hamilton_DriverTools::ACTION::START,
                                          TRACE_LEVEL_DEBUG,
                                          strFunctionName,
                                          "i_intDeviceID = " + IStr(i_intDeviceID),
                                          gInheco_ODTC_intTraceLevel,
                                          gInheco_ODTC_strModuleName);

        if(gInheco_ODTC_blnSimulationMode == ASWGLOBAL::BOOL::TRUE)
        {
          Hamilton_DriverTools::StatusTrace(Hamilton_DriverTools::ACTION::COMPLETE,
                                            TRACE_LEVEL_DEBUG,
                                            "Simulated",
                                            strFunctionName,
                                            gInheco_ODTC_intTraceLevel,
                                            gInheco_ODTC_strModuleName);
          return (ASWGLOBAL::BOOL::TRUE);
        }

        onerror goto DLL_ERROR;
        gInheco_ODTC_arrhdlCriticalSections[i_intDeviceID].WaitEvent(hslInfinite);
        objDevice = gInheco_ODTC_arrobjDevices.ElementAt(i_intDeviceID);
        if(!objDevice.Terminate(o_strSiLAMessage))
        {
          gInheco_ODTC_arrhdlCriticalSections[i_intDeviceID].SetEvent();
          onerror goto 0;
          Hamilton_DriverTools::StatusTrace(Hamilton_DriverTools::ACTION::COMPLETE_WITH_ERROR,
                                            TRACE_LEVEL_RELEASE,
                                            "Failed to terminate device " + IStr(i_intDeviceID) + ", see logfile for details !",
                                            strFunctionName,
                                            gInheco_ODTC_intTraceLevel,
                                            gInheco_ODTC_strModuleName);
          return(ASWGLOBAL::BOOL::FALSE);
        }
        gInheco_ODTC_arrhdlCriticalSections[i_intDeviceID].SetEvent();
        onerror goto 0;

        gInheco_ODTC_arrstrIPAddresses.SetAt(i_intDeviceID,"");

        Hamilton_DriverTools::StatusTrace(Hamilton_DriverTools::ACTION::COMPLETE,
                                          TRACE_LEVEL_DEBUG,
                                          ", o_strSiLAMessage = '" + o_strSiLAMessage + "'",
                                          strFunctionName,
                                          gInheco_ODTC_intTraceLevel,
                                          gInheco_ODTC_strModuleName);
        return(ASWGLOBAL::BOOL::TRUE);

        DLL_ERROR:
        {
          gInheco_ODTC_arrhdlCriticalSections[i_intDeviceID].SetEvent();
          Hamilton_DriverTools::StatusTrace(Hamilton_DriverTools::ACTION::COMPLETE_WITH_ERROR,
                                            TRACE_LEVEL_RELEASE,
                                            "Unhandled exception in dll or dll missing!",
                                            strFunctionName,
                                            gInheco_ODTC_intTraceLevel,
                                            gInheco_ODTC_strModuleName);
          return(ASWGLOBAL::BOOL::FALSE);
        }
      } // Terminate

      //----------------------------------------------------------------------------------------------
      // function EvaluateError
      //----------------------------------------------------------------------------------------------
      function EvaluateError(variable i_intErrorCode,
                             variable& o_strErrorMessage) variable
      {
        o_strErrorMessage = "unknown error!";
        if(i_intErrorCode == ERROR_DEVBUSY)                 o_strErrorMessage = ERROR_MSG_DEVBUSY;
        if(i_intErrorCode == ERROR_ONLOCKID)                o_strErrorMessage = ERROR_MSG_ONLOCKID;
        if(i_intErrorCode == ERROR_REQUESTID)               o_strErrorMessage = ERROR_MSG_REQUESTID;
        if(i_intErrorCode == ERROR_COMMANDNOTALLOWED)       o_strErrorMessage = ERROR_MSG_COMMANDNOTALLOWED;
        if(i_intErrorCode == ERROR_INVALIDCOMANDPARAM)      o_strErrorMessage = ERROR_MSG_INVALIDCOMANDPARAM;
        if(i_intErrorCode == FINISHEDWITHWARNING)           o_strErrorMessage = WARNING_MSG_FINISHEDWITHWARNING;
        if(i_intErrorCode == ERROR_HARDWARE)                o_strErrorMessage = ERROR_MSG_HARDWARE;
        if(i_intErrorCode == ERROR_COMMUNICATION)           o_strErrorMessage = ERROR_MSG_COMMUNICATION;
        if(i_intErrorCode == ERROR_PMSSOFTWARE)             o_strErrorMessage = ERROR_MSG_PMSSOFTWARE;
        if(i_intErrorCode == WARNING_GENERALWARNING)        o_strErrorMessage = ERROR_MSG_HARDWARERUN;
        if(i_intErrorCode == ERROR_HARDWARERUN)             o_strErrorMessage = ERROR_MSG_HARDWARERUN;
        if(i_intErrorCode == ERROR_CONNECTION_ODTC_PCU)     o_strErrorMessage = ERROR_MSG_CONNECTION_ODTC_PCU;
        if(i_intErrorCode == ERROR_DOOR)                    o_strErrorMessage = ERROR_MSG_DOOR;
        if(i_intErrorCode == ERROR_ODTCMETHODERROR)         o_strErrorMessage = ERROR_MSG_ODTCMETHODERROR;
        if(i_intErrorCode == ERROR_UNEXPECTEDBUSERROR)      o_strErrorMessage = ERROR_MSG_UNEXPECTEDBUSERROR;
        if(i_intErrorCode == WARNING_TEMPERATUREOUTOFSPEC)  o_strErrorMessage = WARNING_MSG_TEMPERATUREOUTOFSPEC;
        if(i_intErrorCode == WARNING_GENERALWARNING_2)      o_strErrorMessage = WARNING_MSG_GENERALWARNING_2;
        if(i_intErrorCode == ERROR_ACPOWERLOSS)             o_strErrorMessage = ERROR_MSG_ACPOWERLOSS;

        return(ASWGLOBAL::BOOL::TRUE);
      } // EvaluateError

    } // namespace Standard

    namespace Advanced
    {
      //----------------------------------------------------------------------------------------------
      // function AddAllowedReturnCode
      //----------------------------------------------------------------------------------------------
      function AddAllowedReturnCode(variable i_intDeviceID,
                                    variable i_intReturnValueToIgnore) variable
      {
        object objDevice;
        variable strFunctionName("");

        if(Hamilton_DriverTools::ExtractFunctionName(GetFunctionName(),
                                                     strFunctionName,
                                                     gInheco_ODTC_strModuleName) == ASWGLOBAL::BOOL::FALSE) return(ASWGLOBAL::BOOL::FALSE);

        if(Hamilton_DriverTools::CheckIntegerRange(i_intDeviceID,
                                                   "i_intDeviceID",
                                                   1,
                                                   MAX_DEVICES,
                                                   strFunctionName,
                                                   gInheco_ODTC_strModuleName) == ASWGLOBAL::BOOL::FALSE) return(ASWGLOBAL::BOOL::FALSE);

        if(Hamilton_DriverTools::CheckIntegerRange(i_intReturnValueToIgnore,
                                           "i_intReturnValueToIgnore",
                                           0,
                                           MAX_INT,
                                           strFunctionName,
                                           gInheco_ODTC_strModuleName) == ASWGLOBAL::BOOL::FALSE) return(ASWGLOBAL::BOOL::FALSE);

        Hamilton_DriverTools::StatusTrace(Hamilton_DriverTools::ACTION::START,
                                          TRACE_LEVEL_DEBUG,
                                          "i_intDeviceID = " + IStr(i_intDeviceID) +
                                          ", i_intReturnValueToIgnore = " + IStr(i_intReturnValueToIgnore),
                                          strFunctionName,
                                          gInheco_ODTC_intTraceLevel,
                                          gInheco_ODTC_strModuleName);

        if(gInheco_ODTC_blnSimulationMode == ASWGLOBAL::BOOL::TRUE)
        {
          Hamilton_DriverTools::StatusTrace(Hamilton_DriverTools::ACTION::COMPLETE,
                                            TRACE_LEVEL_DEBUG,
                                            "Simulated",
                                            strFunctionName,
                                            gInheco_ODTC_intTraceLevel,
                                            gInheco_ODTC_strModuleName);
          return (ASWGLOBAL::BOOL::TRUE);
        }

        onerror goto DLL_ERROR;
        gInheco_ODTC_arrhdlCriticalSections[i_intDeviceID].WaitEvent(hslInfinite);
        objDevice = gInheco_ODTC_arrobjDevices.ElementAt(i_intDeviceID);
        if(!objDevice.AddAllowedReturnCode(i_intReturnValueToIgnore))
        {
          gInheco_ODTC_arrhdlCriticalSections[i_intDeviceID].SetEvent();
          onerror goto 0;
          Hamilton_DriverTools::StatusTrace(Hamilton_DriverTools::ACTION::COMPLETE_WITH_ERROR,
                                            TRACE_LEVEL_RELEASE,
                                            "Failed to add allowed return code for device " + IStr(i_intDeviceID) + ", see logfile for details !",
                                            strFunctionName,
                                            gInheco_ODTC_intTraceLevel,
                                            gInheco_ODTC_strModuleName);
          return(ASWGLOBAL::BOOL::FALSE);
        }
        gInheco_ODTC_arrhdlCriticalSections[i_intDeviceID].SetEvent();
        onerror goto 0;

        Hamilton_DriverTools::StatusTrace(Hamilton_DriverTools::ACTION::COMPLETE,
                                          TRACE_LEVEL_DEBUG,
                                          "",
                                          strFunctionName,
                                          gInheco_ODTC_intTraceLevel,
                                          gInheco_ODTC_strModuleName);
        return(ASWGLOBAL::BOOL::TRUE);

        DLL_ERROR:
        {
          gInheco_ODTC_arrhdlCriticalSections[i_intDeviceID].SetEvent();
          Hamilton_DriverTools::StatusTrace(Hamilton_DriverTools::ACTION::COMPLETE_WITH_ERROR,
                                            TRACE_LEVEL_RELEASE,
                                            "Unhandled exception in dll or dll missing!",
                                            strFunctionName,
                                            gInheco_ODTC_intTraceLevel,
                                            gInheco_ODTC_strModuleName);
          return(ASWGLOBAL::BOOL::FALSE);
        }
      } // AddAllowedReturnCode

      //----------------------------------------------------------------------------------------------
      // function LockDevice
      //----------------------------------------------------------------------------------------------
      function LockDevice(variable i_intDeviceID,
                          variable i_intTimeout, 
                          variable i_strPMSID, 
                          variable i_strLockID,
                          variable& o_intSiLAReturnValue,
                          variable& o_strSiLAMessage) variable
      {
        object objDevice;
        variable strFunctionName("");
        o_strSiLAMessage="in Simulation";

        if(Hamilton_DriverTools::ExtractFunctionName(GetFunctionName(),
                                                     strFunctionName,
                                                     gInheco_ODTC_strModuleName) == ASWGLOBAL::BOOL::FALSE) return(ASWGLOBAL::BOOL::FALSE);

        if(Hamilton_DriverTools::CheckIntegerRange(i_intDeviceID,
                                                   "i_intDeviceID",
                                                   1,
                                                   MAX_DEVICES,
                                                   strFunctionName,
                                                   gInheco_ODTC_strModuleName) == ASWGLOBAL::BOOL::FALSE) return(ASWGLOBAL::BOOL::FALSE);

        if(Hamilton_DriverTools::CheckIntegerRange(i_intTimeout,
                                                   "i_intTimeout",
                                                   1,
                                                   MAX_INT,
                                                   strFunctionName,
                                                   gInheco_ODTC_strModuleName) == ASWGLOBAL::BOOL::FALSE) return(ASWGLOBAL::BOOL::FALSE);

        if(Hamilton_DriverTools::CheckString(i_strPMSID,
                                             "i_strPMSID",
                                             strFunctionName,
                                             gInheco_ODTC_strModuleName) == ASWGLOBAL::BOOL::FALSE) return(ASWGLOBAL::BOOL::FALSE);

        if(Hamilton_DriverTools::CheckString(i_strLockID,
                                             "i_strLockID",
                                             strFunctionName,
                                             gInheco_ODTC_strModuleName) == ASWGLOBAL::BOOL::FALSE) return(ASWGLOBAL::BOOL::FALSE);

        Hamilton_DriverTools::StatusTrace(Hamilton_DriverTools::ACTION::START,
                                          TRACE_LEVEL_DEBUG,
                                          "i_intDeviceID = " + IStr(i_intDeviceID) +
                                          ", i_intTimeout = " + IStr(i_intTimeout) +
                                          ", i_strPMSID = '" + i_strPMSID + "'" +
                                          ", i_strLockID = '" + i_strLockID + "'",
                                          strFunctionName,
                                          gInheco_ODTC_intTraceLevel,
                                          gInheco_ODTC_strModuleName);

        if(gInheco_ODTC_blnSimulationMode == ASWGLOBAL::BOOL::TRUE)
        {
          Hamilton_DriverTools::StatusTrace(Hamilton_DriverTools::ACTION::COMPLETE,
                                            TRACE_LEVEL_DEBUG,
                                            strFunctionName,
                                            "Simulated",
                                            gInheco_ODTC_intTraceLevel,
                                            gInheco_ODTC_strModuleName);
          return (ASWGLOBAL::BOOL::TRUE);
        }

        onerror goto DLL_ERROR;
        gInheco_ODTC_arrhdlCriticalSections[i_intDeviceID].WaitEvent(hslInfinite);
        objDevice = gInheco_ODTC_arrobjDevices.ElementAt(i_intDeviceID);
        if(!objDevice.LockDevice(i_intTimeout, 
                                 i_strPMSID,
                                 i_strLockID, 
                                 o_intSiLAReturnValue,
                                 o_strSiLAMessage))
        {
          gInheco_ODTC_arrhdlCriticalSections[i_intDeviceID].SetEvent();
          onerror goto 0;
          Hamilton_DriverTools::StatusTrace(Hamilton_DriverTools::ACTION::COMPLETE_WITH_ERROR,
                                            TRACE_LEVEL_RELEASE,
                                            "Failed to lock device " + IStr(i_intDeviceID) + ", see logfile for details !",
                                            strFunctionName,
                                            gInheco_ODTC_intTraceLevel,
                                            gInheco_ODTC_strModuleName);
          return(ASWGLOBAL::BOOL::FALSE);
        }
        gInheco_ODTC_arrhdlCriticalSections[i_intDeviceID].SetEvent();
        onerror goto 0;

        Hamilton_DriverTools::StatusTrace(Hamilton_DriverTools::ACTION::COMPLETE,
                                          TRACE_LEVEL_DEBUG,
                                          "o_intSiLAReturnValue = " + IStr(o_intSiLAReturnValue) +
                                          ", o_strSiLAMessage = '" + o_strSiLAMessage + "'",
                                          strFunctionName,
                                          gInheco_ODTC_intTraceLevel,
                                          gInheco_ODTC_strModuleName);
        return(ASWGLOBAL::BOOL::TRUE);

        DLL_ERROR:
        {
          gInheco_ODTC_arrhdlCriticalSections[i_intDeviceID].SetEvent();
          Hamilton_DriverTools::StatusTrace(Hamilton_DriverTools::ACTION::COMPLETE_WITH_ERROR,
                                            TRACE_LEVEL_RELEASE,
                                            "Unhandled exception in dll or dll missing!",
                                            strFunctionName,
                                            gInheco_ODTC_intTraceLevel,
                                            gInheco_ODTC_strModuleName);
          return(ASWGLOBAL::BOOL::FALSE);
        }
      } // LockDevice

      //----------------------------------------------------------------------------------------------
      // function UnlockDevice unlocks the device after an preceeding lockdevice command
      //----------------------------------------------------------------------------------------------
      function UnlockDevice(variable i_intDeviceID,
                            variable i_strLockID,
                            variable& o_intSiLAReturnValue,
                            variable& o_strSiLAMessage) variable
      {
        object objDevice;
        variable strFunctionName("");
        o_strSiLAMessage="in Simulation";

        if(Hamilton_DriverTools::ExtractFunctionName(GetFunctionName(),
                                                     strFunctionName,
                                                     gInheco_ODTC_strModuleName) == ASWGLOBAL::BOOL::FALSE) return(ASWGLOBAL::BOOL::FALSE);

        if(Hamilton_DriverTools::CheckIntegerRange(i_intDeviceID,
                                                   "i_intDeviceID",
                                                   1,
                                                   MAX_DEVICES,
                                                   strFunctionName,
                                                   gInheco_ODTC_strModuleName) == ASWGLOBAL::BOOL::FALSE) return(ASWGLOBAL::BOOL::FALSE);

        if(Hamilton_DriverTools::CheckString(i_strLockID,
                                             "i_strLockID",
                                             strFunctionName,
                                             gInheco_ODTC_strModuleName) == ASWGLOBAL::BOOL::FALSE) return(ASWGLOBAL::BOOL::FALSE);

        Hamilton_DriverTools::StatusTrace(Hamilton_DriverTools::ACTION::START,
                                          TRACE_LEVEL_DEBUG,
                                          "i_intDeviceID = " + IStr(i_intDeviceID) +
                                          ", i_strLockID = '" + i_strLockID + "'",
                                          strFunctionName,
                                          gInheco_ODTC_intTraceLevel,
                                          gInheco_ODTC_strModuleName);

        if(gInheco_ODTC_blnSimulationMode == ASWGLOBAL::BOOL::TRUE)
        {
          Hamilton_DriverTools::StatusTrace(Hamilton_DriverTools::ACTION::COMPLETE,
                                            TRACE_LEVEL_DEBUG,
                                            strFunctionName,
                                            "Simulated",
                                            gInheco_ODTC_intTraceLevel,
                                            gInheco_ODTC_strModuleName);
          return (ASWGLOBAL::BOOL::TRUE);
        }

        onerror goto DLL_ERROR;
        gInheco_ODTC_arrhdlCriticalSections[i_intDeviceID].WaitEvent(hslInfinite);
        objDevice = gInheco_ODTC_arrobjDevices.ElementAt(i_intDeviceID);
        if(!objDevice.UnlockDevice(i_strLockID,
                                   o_intSiLAReturnValue, 
                                   o_strSiLAMessage))
        {
          gInheco_ODTC_arrhdlCriticalSections[i_intDeviceID].SetEvent();
          onerror goto 0;
          Hamilton_DriverTools::StatusTrace(Hamilton_DriverTools::ACTION::COMPLETE_WITH_ERROR,
                                            TRACE_LEVEL_RELEASE,
                                            "Failed to unlock device " + IStr(i_intDeviceID) + ", see logfile for details !",
                                            strFunctionName,
                                            gInheco_ODTC_intTraceLevel,
                                            gInheco_ODTC_strModuleName);
          return(ASWGLOBAL::BOOL::FALSE);
        }
        gInheco_ODTC_arrhdlCriticalSections[i_intDeviceID].SetEvent();
        onerror goto 0;

        Hamilton_DriverTools::StatusTrace(Hamilton_DriverTools::ACTION::COMPLETE,
                                          TRACE_LEVEL_DEBUG,
                                          "o_intSiLAReturnValue = " + IStr(o_intSiLAReturnValue) +
                                          ", o_strSiLAMessage = '" + o_strSiLAMessage + "'",
                                          strFunctionName,
                                          gInheco_ODTC_intTraceLevel,
                                          gInheco_ODTC_strModuleName);
        return(ASWGLOBAL::BOOL::TRUE);

        DLL_ERROR:
        {
          gInheco_ODTC_arrhdlCriticalSections[i_intDeviceID].SetEvent();
          Hamilton_DriverTools::StatusTrace(Hamilton_DriverTools::ACTION::COMPLETE_WITH_ERROR,
                                            TRACE_LEVEL_RELEASE,
                                            "Unhandled exception in dll or dll missing!",
                                            strFunctionName,
                                            gInheco_ODTC_intTraceLevel,
                                            gInheco_ODTC_strModuleName);
          return(ASWGLOBAL::BOOL::FALSE);
        }
      } // UnlockDevice

      //----------------------------------------------------------------------------------------------
      // function SetCSVSeparator
      //----------------------------------------------------------------------------------------------
      function SetCSVSeparator(variable i_intDeviceID,
                               variable i_strLockID,
                               variable i_strCSVSeparator,
                               variable& o_intSiLAReturnValue,
                               variable& o_strSiLAMessage) variable
      {
        object objDevice;
        variable strFunctionName("");
        o_strSiLAMessage="in Simulation";

        if(Hamilton_DriverTools::ExtractFunctionName(GetFunctionName(),
                                                     strFunctionName,
                                                     gInheco_ODTC_strModuleName) == ASWGLOBAL::BOOL::FALSE) return(ASWGLOBAL::BOOL::FALSE);

        if(Hamilton_DriverTools::CheckIntegerRange(i_intDeviceID,
                                                   "i_intDeviceID",
                                                   1,
                                                   MAX_DEVICES,
                                                   strFunctionName,
                                                   gInheco_ODTC_strModuleName) == ASWGLOBAL::BOOL::FALSE) return(ASWGLOBAL::BOOL::FALSE);

        if(Hamilton_DriverTools::CheckString(i_strLockID,
                                             "i_strLockID",
                                             strFunctionName,
                                             gInheco_ODTC_strModuleName) == ASWGLOBAL::BOOL::FALSE) return(ASWGLOBAL::BOOL::FALSE);

        if(Hamilton_DriverTools::CheckString(i_strCSVSeparator,
                                             "i_strCSVSeparator",
                                             strFunctionName,
                                             gInheco_ODTC_strModuleName) == ASWGLOBAL::BOOL::FALSE) return(ASWGLOBAL::BOOL::FALSE);

        Hamilton_DriverTools::StatusTrace(Hamilton_DriverTools::ACTION::START,
                                          TRACE_LEVEL_DEBUG,
                                          "i_intDeviceID = " + IStr(i_intDeviceID) +
                                          ", i_strLockID = '" + i_strLockID + "'" +
                                          ", i_strCSVSeparator = '" + i_strCSVSeparator + "'",
                                          strFunctionName,
                                          gInheco_ODTC_intTraceLevel,
                                          gInheco_ODTC_strModuleName);

        if(gInheco_ODTC_blnSimulationMode == ASWGLOBAL::BOOL::TRUE)
        {
          Hamilton_DriverTools::StatusTrace(Hamilton_DriverTools::ACTION::COMPLETE,
                                            TRACE_LEVEL_DEBUG,
                                            strFunctionName,
                                            "Simulated",
                                            gInheco_ODTC_intTraceLevel,
                                            gInheco_ODTC_strModuleName);
          return (ASWGLOBAL::BOOL::TRUE);
        }

        onerror goto DLL_ERROR;
        gInheco_ODTC_arrhdlCriticalSections[i_intDeviceID].WaitEvent(hslInfinite);
        objDevice = gInheco_ODTC_arrobjDevices.ElementAt(i_intDeviceID);
        if(!objDevice.SetCSVCharacter(i_strLockID,
                                      i_strCSVSeparator,
                                      o_intSiLAReturnValue, 
                                      o_strSiLAMessage))
        {
          gInheco_ODTC_arrhdlCriticalSections[i_intDeviceID].SetEvent();
          onerror goto 0;
          Hamilton_DriverTools::StatusTrace(Hamilton_DriverTools::ACTION::COMPLETE_WITH_ERROR,
                                            TRACE_LEVEL_RELEASE,
                                            "Failed to set CVS separator for device " + IStr(i_intDeviceID) + ", see logfile for details !",
                                            strFunctionName,
                                            gInheco_ODTC_intTraceLevel,
                                            gInheco_ODTC_strModuleName);
          return(ASWGLOBAL::BOOL::FALSE);
        }
        gInheco_ODTC_arrhdlCriticalSections[i_intDeviceID].SetEvent();
        onerror goto 0;

        Hamilton_DriverTools::StatusTrace(Hamilton_DriverTools::ACTION::COMPLETE,
                                          TRACE_LEVEL_DEBUG,
                                          "o_intSiLAReturnValue = " + IStr(o_intSiLAReturnValue) +
                                          ", o_strSiLAMessage = '" + o_strSiLAMessage + "'",
                                          strFunctionName,
                                          gInheco_ODTC_intTraceLevel,
                                          gInheco_ODTC_strModuleName);
        return(ASWGLOBAL::BOOL::TRUE);

        DLL_ERROR:
        {
          gInheco_ODTC_arrhdlCriticalSections[i_intDeviceID].SetEvent();
          Hamilton_DriverTools::StatusTrace(Hamilton_DriverTools::ACTION::COMPLETE_WITH_ERROR,
                                            TRACE_LEVEL_RELEASE,
                                            "Unhandled exception in dll or dll missing!",
                                            strFunctionName,
                                            gInheco_ODTC_intTraceLevel,
                                            gInheco_ODTC_strModuleName);
          return(ASWGLOBAL::BOOL::FALSE);
        }
      } // SetCSVSeparator

      //----------------------------------------------------------------------------------------------
      // function SetDateTime
      //----------------------------------------------------------------------------------------------
      function SetDateTime(variable i_intDeviceID,
                           variable i_strLockID,
                           variable i_strDateTime,
                           variable &o_intSiLAReturnValue,
                           variable &o_strSiLAMessage) variable
      {
        object objDevice;
        variable strFunctionName("");

        if(Hamilton_DriverTools::ExtractFunctionName(GetFunctionName(),
                                                     strFunctionName,
                                                     gInheco_ODTC_strModuleName) == ASWGLOBAL::BOOL::FALSE) return(ASWGLOBAL::BOOL::FALSE);
        o_strSiLAMessage="in Simulation";

        if(Hamilton_DriverTools::CheckIntegerRange(i_intDeviceID,
                                                   "i_intDeviceID",
                                                   1,
                                                   MAX_DEVICES,
                                                   strFunctionName,
                                                   gInheco_ODTC_strModuleName) == ASWGLOBAL::BOOL::FALSE) return(ASWGLOBAL::BOOL::FALSE);

        if(Hamilton_DriverTools::CheckString(i_strLockID,
                                             "i_strLockID",
                                             strFunctionName,
                                             gInheco_ODTC_strModuleName) == ASWGLOBAL::BOOL::FALSE) return(ASWGLOBAL::BOOL::FALSE);

        if(Hamilton_DriverTools::CheckString(i_strDateTime,
                                             "i_strDateTime",
                                             strFunctionName,
                                             gInheco_ODTC_strModuleName) == ASWGLOBAL::BOOL::FALSE) return(ASWGLOBAL::BOOL::FALSE);

        Hamilton_DriverTools::StatusTrace(Hamilton_DriverTools::ACTION::START,
                                          TRACE_LEVEL_DEBUG,
                                          "i_intDeviceID = " + IStr(i_intDeviceID) +
                                          ", i_strLockID = '" + i_strLockID + "'" +
                                          ", i_strDateTime = '" + i_strDateTime + "'",
                                          strFunctionName,
                                          gInheco_ODTC_intTraceLevel,
                                          gInheco_ODTC_strModuleName);

        if(gInheco_ODTC_blnSimulationMode == ASWGLOBAL::BOOL::TRUE)
        {
          Hamilton_DriverTools::StatusTrace(Hamilton_DriverTools::ACTION::COMPLETE,
                                            TRACE_LEVEL_DEBUG,
                                            strFunctionName,
                                            "Simulated",
                                            gInheco_ODTC_intTraceLevel,
                                            gInheco_ODTC_strModuleName);
          return (ASWGLOBAL::BOOL::TRUE);
        }

        onerror goto DLL_ERROR;
        gInheco_ODTC_arrhdlCriticalSections[i_intDeviceID].WaitEvent(hslInfinite);
        objDevice = gInheco_ODTC_arrobjDevices.ElementAt(i_intDeviceID);
        if(!objDevice.SetTimeConfiguration(i_strLockID,
                                           i_strDateTime,
                                           o_intSiLAReturnValue, 
                                           o_strSiLAMessage))
        {
          gInheco_ODTC_arrhdlCriticalSections[i_intDeviceID].SetEvent();
          onerror goto 0;
          Hamilton_DriverTools::StatusTrace(Hamilton_DriverTools::ACTION::COMPLETE_WITH_ERROR,
                                            TRACE_LEVEL_RELEASE,
                                            "Failed to set time configuration for device " + IStr(i_intDeviceID) + ", see logfile for details !",
                                            strFunctionName,
                                            gInheco_ODTC_intTraceLevel,
                                            gInheco_ODTC_strModuleName);
          return(ASWGLOBAL::BOOL::FALSE);
        }
        gInheco_ODTC_arrhdlCriticalSections[i_intDeviceID].SetEvent();
        onerror goto 0;

        Hamilton_DriverTools::StatusTrace(Hamilton_DriverTools::ACTION::COMPLETE,
                                          TRACE_LEVEL_DEBUG,
                                          "o_intSiLAReturnValue = " + IStr(o_intSiLAReturnValue) +
                                          ", o_strSiLAMessage = '" + o_strSiLAMessage + "'",
                                          strFunctionName,
                                          gInheco_ODTC_intTraceLevel,
                                          gInheco_ODTC_strModuleName);
        return(ASWGLOBAL::BOOL::TRUE);

        DLL_ERROR:
        {
          gInheco_ODTC_arrhdlCriticalSections[i_intDeviceID].SetEvent();
          Hamilton_DriverTools::StatusTrace(Hamilton_DriverTools::ACTION::COMPLETE_WITH_ERROR,
                                            TRACE_LEVEL_RELEASE,
                                            "Unhandled exception in dll or dll missing!",
                                            strFunctionName,
                                            gInheco_ODTC_intTraceLevel,
                                            gInheco_ODTC_strModuleName);
          return(ASWGLOBAL::BOOL::FALSE);
        }
      } // SetDateTime

      //----------------------------------------------------------------------------------------------
      // function SetNetWorkConfig
      //----------------------------------------------------------------------------------------------
      function SetNetWorkConfig(variable i_intDeviceID,
                                variable i_strLockID,
                                variable i_strIPAddress,
                                variable i_strSubNet,
                                variable i_strGateWay,
                                variable i_strDNS1,
                                variable i_strDNS2,
                                variable& o_intSiLAReturnValue,
                                variable& o_strSiLAMessage) variable
      {
        object objDevice;
        variable strFunctionName("");
        o_strSiLAMessage="in Simulation";

        if(Hamilton_DriverTools::ExtractFunctionName(GetFunctionName(),
                                                     strFunctionName,
                                                     gInheco_ODTC_strModuleName) == ASWGLOBAL::BOOL::FALSE) return(ASWGLOBAL::BOOL::FALSE);

        if(Hamilton_DriverTools::CheckIntegerRange(i_intDeviceID,
                                                   "i_intDeviceID",
                                                   1,
                                                   MAX_DEVICES,
                                                   strFunctionName,
                                                   gInheco_ODTC_strModuleName) == ASWGLOBAL::BOOL::FALSE) return(ASWGLOBAL::BOOL::FALSE);

        if(Hamilton_DriverTools::CheckString(i_strLockID,
                                             "i_strLockID",
                                             strFunctionName,
                                             gInheco_ODTC_strModuleName) == ASWGLOBAL::BOOL::FALSE) return(ASWGLOBAL::BOOL::FALSE);

        if(Hamilton_DriverTools::CheckString(i_strIPAddress,
                                             "i_strIPAddress",
                                             strFunctionName,
                                             gInheco_ODTC_strModuleName) == ASWGLOBAL::BOOL::FALSE) return(ASWGLOBAL::BOOL::FALSE);

        if(Hamilton_DriverTools::CheckString(i_strSubNet,
                                             "i_strSubNet",
                                             strFunctionName,
                                             gInheco_ODTC_strModuleName) == ASWGLOBAL::BOOL::FALSE) return(ASWGLOBAL::BOOL::FALSE);

        if(Hamilton_DriverTools::CheckString(i_strGateWay,
                                             "i_strGateWay",
                                             strFunctionName,
                                             gInheco_ODTC_strModuleName) == ASWGLOBAL::BOOL::FALSE) return(ASWGLOBAL::BOOL::FALSE);

        if(Hamilton_DriverTools::CheckString(i_strDNS1,
                                             "i_strDNS1",
                                             strFunctionName,
                                             gInheco_ODTC_strModuleName) == ASWGLOBAL::BOOL::FALSE) return(ASWGLOBAL::BOOL::FALSE);

        if(Hamilton_DriverTools::CheckString(i_strDNS2,
                                             "i_strDNS2",
                                             strFunctionName,
                                             gInheco_ODTC_strModuleName) == ASWGLOBAL::BOOL::FALSE) return(ASWGLOBAL::BOOL::FALSE);

        Hamilton_DriverTools::StatusTrace(Hamilton_DriverTools::ACTION::START,
                                          TRACE_LEVEL_DEBUG,
                                          "i_intDeviceID = " + IStr(i_intDeviceID) +
                                          ", i_strLockID = '" + i_strLockID + "'" +
                                          ", i_strIPAddress = '" + i_strIPAddress + "'" +
                                          ", i_strSubNet = '" + i_strSubNet + "'" +
                                          ", i_strGateWay = '" + i_strGateWay + "'" +
                                          ", i_strDNS1 = '" + i_strDNS1 + "'" +
                                          ", i_strDNS2 = '" + i_strDNS2 + "'",
                                          strFunctionName,
                                          gInheco_ODTC_intTraceLevel,
                                          gInheco_ODTC_strModuleName);

        if(gInheco_ODTC_blnSimulationMode == ASWGLOBAL::BOOL::TRUE)
        {
          Hamilton_DriverTools::StatusTrace(Hamilton_DriverTools::ACTION::COMPLETE,
                                            TRACE_LEVEL_DEBUG,
                                            strFunctionName,
                                            "Simulated",
                                            gInheco_ODTC_intTraceLevel,
                                            gInheco_ODTC_strModuleName);
          return (ASWGLOBAL::BOOL::TRUE);
        }

        onerror goto DLL_ERROR;
        gInheco_ODTC_arrhdlCriticalSections[i_intDeviceID].WaitEvent(hslInfinite);
        objDevice = gInheco_ODTC_arrobjDevices.ElementAt(i_intDeviceID);
        if(!objDevice.SetNetWorkConfiguration(i_strLockID, 
                                              i_strIPAddress, 
                                              i_strSubNet, 
                                              i_strGateWay, 
                                              i_strDNS1, 
                                              i_strDNS2, 
                                              o_intSiLAReturnValue, 
                                              o_strSiLAMessage))
        {
          gInheco_ODTC_arrhdlCriticalSections[i_intDeviceID].SetEvent();
          onerror goto 0;
          Hamilton_DriverTools::StatusTrace(Hamilton_DriverTools::ACTION::COMPLETE_WITH_ERROR,
                                            TRACE_LEVEL_RELEASE,
                                            "Failed to set network configuration for device " + IStr(i_intDeviceID) + ", see logfile for details !",
                                            strFunctionName,
                                            gInheco_ODTC_intTraceLevel,
                                            gInheco_ODTC_strModuleName);
          return(ASWGLOBAL::BOOL::FALSE);
        }
        gInheco_ODTC_arrhdlCriticalSections[i_intDeviceID].SetEvent();
        onerror goto 0;

        Hamilton_DriverTools::StatusTrace(Hamilton_DriverTools::ACTION::COMPLETE,
                                          TRACE_LEVEL_DEBUG,
                                          "o_intSiLAReturnValue = " + IStr(o_intSiLAReturnValue) +
                                          ", o_strSiLAMessage = '" + o_strSiLAMessage + "'",
                                          strFunctionName,
                                          gInheco_ODTC_intTraceLevel,
                                          gInheco_ODTC_strModuleName);
        return(ASWGLOBAL::BOOL::TRUE);

        DLL_ERROR:
        {
          gInheco_ODTC_arrhdlCriticalSections[i_intDeviceID].SetEvent();
          Hamilton_DriverTools::StatusTrace(Hamilton_DriverTools::ACTION::COMPLETE_WITH_ERROR,
                                            TRACE_LEVEL_RELEASE,
                                            "Unhandled exception in dll or dll missing!",
                                            strFunctionName,
                                            gInheco_ODTC_intTraceLevel,
                                            gInheco_ODTC_strModuleName);
          return(ASWGLOBAL::BOOL::FALSE);
        }
      } // SetNetWorkConfig

      //----------------------------------------------------------------------------------------------
      // function GetParameters
      //----------------------------------------------------------------------------------------------
      function GetParameters(variable i_intDeviceID,
                             variable i_strLockID,
                             variable& o_strParametersXML,
                             variable& o_intSiLAReturnValue,
                             variable& o_strSiLAMessage) variable
      {
        object objDevice;
        variable strFunctionName("");
        o_strSiLAMessage="in Simulation";

        if(Hamilton_DriverTools::ExtractFunctionName(GetFunctionName(),
                                                     strFunctionName,
                                                     gInheco_ODTC_strModuleName) == ASWGLOBAL::BOOL::FALSE) return(ASWGLOBAL::BOOL::FALSE);

        if(Hamilton_DriverTools::CheckIntegerRange(i_intDeviceID,
                                                   "i_intDeviceID",
                                                   1,
                                                   MAX_DEVICES,
                                                   strFunctionName,
                                                   gInheco_ODTC_strModuleName) == ASWGLOBAL::BOOL::FALSE) return(ASWGLOBAL::BOOL::FALSE);

        if(Hamilton_DriverTools::CheckString(i_strLockID,
                                             "i_strLockID",
                                             strFunctionName,
                                             gInheco_ODTC_strModuleName) == ASWGLOBAL::BOOL::FALSE) return(ASWGLOBAL::BOOL::FALSE);

        Hamilton_DriverTools::StatusTrace(Hamilton_DriverTools::ACTION::START,
                                          TRACE_LEVEL_DEBUG,
                                          "i_intDeviceID = " + IStr(i_intDeviceID) +
                                          ", i_strLockID = '" + i_strLockID + "'",
                                          strFunctionName,
                                          gInheco_ODTC_intTraceLevel,
                                          gInheco_ODTC_strModuleName);

        if(gInheco_ODTC_blnSimulationMode == ASWGLOBAL::BOOL::TRUE)
        {
          Hamilton_DriverTools::StatusTrace(Hamilton_DriverTools::ACTION::COMPLETE,
                                            TRACE_LEVEL_DEBUG,
                                            strFunctionName,
                                            "Simulated",
                                            gInheco_ODTC_intTraceLevel,
                                            gInheco_ODTC_strModuleName);
          return (ASWGLOBAL::BOOL::TRUE);
        }

        onerror goto DLL_ERROR;
        gInheco_ODTC_arrhdlCriticalSections[i_intDeviceID].WaitEvent(hslInfinite);
        objDevice = gInheco_ODTC_arrobjDevices.ElementAt(i_intDeviceID);
        if(!objDevice.GetParameters(i_strLockID,
                                    o_strParametersXML,
                                    o_intSiLAReturnValue,
                                    o_strSiLAMessage))
        {
          gInheco_ODTC_arrhdlCriticalSections[i_intDeviceID].SetEvent();
          onerror goto 0;
          Hamilton_DriverTools::StatusTrace(Hamilton_DriverTools::ACTION::COMPLETE_WITH_ERROR,
                                            TRACE_LEVEL_RELEASE,
                                            "Failed to get parameters of device " + IStr(i_intDeviceID) + ", see logfile for details !",
                                            strFunctionName,
                                            gInheco_ODTC_intTraceLevel,
                                            gInheco_ODTC_strModuleName);
          return(ASWGLOBAL::BOOL::FALSE);
        }
        gInheco_ODTC_arrhdlCriticalSections[i_intDeviceID].SetEvent();
        onerror goto 0;

        Hamilton_DriverTools::StatusTrace(Hamilton_DriverTools::ACTION::COMPLETE,
                                          TRACE_LEVEL_DEBUG,
                                          "o_strParametersXML = '" + o_strParametersXML + "'" +
                                          ", o_intSiLAReturnValue = " + IStr(o_intSiLAReturnValue) +
                                          ", o_strSiLAMessage = '" + o_strSiLAMessage + "'",
                                          strFunctionName,
                                          gInheco_ODTC_intTraceLevel,
                                          gInheco_ODTC_strModuleName);
        return(ASWGLOBAL::BOOL::TRUE);

        DLL_ERROR:
        {
          gInheco_ODTC_arrhdlCriticalSections[i_intDeviceID].SetEvent();
          Hamilton_DriverTools::StatusTrace(Hamilton_DriverTools::ACTION::COMPLETE_WITH_ERROR,
                                            TRACE_LEVEL_RELEASE,
                                            "Unhandled exception in dll or dll missing!",
                                            strFunctionName,
                                            gInheco_ODTC_intTraceLevel,
                                            gInheco_ODTC_strModuleName);
          return(ASWGLOBAL::BOOL::FALSE);
        }
      } // GetParameters

      //----------------------------------------------------------------------------------------------
      // function GetDeviceIdentification
      //----------------------------------------------------------------------------------------------
       function GetDeviceIdentification(variable i_intDeviceID,
                                        variable i_strLockID,
                                        variable &o_strDeviceFirmwareVersion, 
                                        variable &o_strDeviceManufacturer,
                                        variable &o_strDeviceName, 
                                        variable &o_strDeviceSerialNumber, 
                                        variable &o_strSiLAInterfaceVersion,
                                        variable &o_strSiLASubDeviceClass, 
                                        variable &o_strWsdl,
                                        variable &o_intSiLAReturnValue,
                                        variable &o_strSiLAMessage) variable
      {
        object objDevice;
        variable strFunctionName("");
        o_strSiLAMessage="in Simulation";
        o_strDeviceFirmwareVersion="in Simulation";
        o_strDeviceManufacturer="in Simulation";
        o_strDeviceName="in Simulation";
        o_strDeviceSerialNumber="in Simulation";
        o_strSiLAInterfaceVersion="in Simulation";
        o_strSiLASubDeviceClass="in Simulation";
        o_strWsdl="in Simulation";

        if(Hamilton_DriverTools::ExtractFunctionName(GetFunctionName(),
                                                     strFunctionName,
                                                     gInheco_ODTC_strModuleName) == ASWGLOBAL::BOOL::FALSE) return(ASWGLOBAL::BOOL::FALSE);

        if(Hamilton_DriverTools::CheckIntegerRange(i_intDeviceID,
                                                   "i_intDeviceID",
                                                   1,
                                                   MAX_DEVICES,
                                                   strFunctionName,
                                                   gInheco_ODTC_strModuleName) == ASWGLOBAL::BOOL::FALSE) return(ASWGLOBAL::BOOL::FALSE);

        if(Hamilton_DriverTools::CheckString(i_strLockID,
                                           "i_strLockID",
                                           strFunctionName,
                                           gInheco_ODTC_strModuleName) == ASWGLOBAL::BOOL::FALSE) return(ASWGLOBAL::BOOL::FALSE);

        Hamilton_DriverTools::StatusTrace(Hamilton_DriverTools::ACTION::START,
                                          TRACE_LEVEL_DEBUG,
                                          "i_intDeviceID = " + IStr(i_intDeviceID) +
                                          ", i_strLockID = '" + i_strLockID + "'",
                                          strFunctionName,
                                          gInheco_ODTC_intTraceLevel,
                                          gInheco_ODTC_strModuleName);

        if(gInheco_ODTC_blnSimulationMode == ASWGLOBAL::BOOL::TRUE)
        {
          Hamilton_DriverTools::StatusTrace(Hamilton_DriverTools::ACTION::COMPLETE,
                                            TRACE_LEVEL_DEBUG,
                                            strFunctionName,
                                            "Simulated",
                                        
                                            gInheco_ODTC_intTraceLevel,
                                            gInheco_ODTC_strModuleName);
          return (ASWGLOBAL::BOOL::TRUE);
        }

        onerror goto DLL_ERROR;
        gInheco_ODTC_arrhdlCriticalSections[i_intDeviceID].WaitEvent(hslInfinite);
        objDevice = gInheco_ODTC_arrobjDevices.ElementAt(i_intDeviceID);
        if(!objDevice.GetDeviceIdentification(i_strLockID,
                                              o_strDeviceFirmwareVersion, 
                                              o_strDeviceManufacturer,
                                              o_strDeviceName, 
                                              o_strDeviceSerialNumber, 
                                              o_strSiLAInterfaceVersion,
                                              o_strSiLASubDeviceClass, 
                                              o_strWsdl,
                                              o_intSiLAReturnValue,
                                              o_strSiLAMessage))
        {
          gInheco_ODTC_arrhdlCriticalSections[i_intDeviceID].SetEvent();
          onerror goto 0;
          Hamilton_DriverTools::StatusTrace(Hamilton_DriverTools::ACTION::COMPLETE_WITH_ERROR,
                                            TRACE_LEVEL_RELEASE,
                                            "Failed to get device identification from device " + IStr(i_intDeviceID) + ", see logfile for details !",
                                            strFunctionName,
                                            gInheco_ODTC_intTraceLevel,
                                            gInheco_ODTC_strModuleName);
          return(ASWGLOBAL::BOOL::FALSE);
        }
        gInheco_ODTC_arrhdlCriticalSections[i_intDeviceID].SetEvent();
        onerror goto 0;

        Hamilton_DriverTools::StatusTrace(Hamilton_DriverTools::ACTION::COMPLETE,
                                          TRACE_LEVEL_DEBUG,
                                          "o_strDeviceFirmwareVersion = '" + o_strDeviceFirmwareVersion + "'"+
                                          ", o_strDeviceManufacturer = '" + o_strDeviceManufacturer + "'" +
                                          ", o_strDeviceName = '" + o_strDeviceName + "'" +
                                          ", o_strDeviceSerialNumber = '" + o_strDeviceSerialNumber + "'" +
                                          ", o_strSiLAInterfaceVersion = '" + o_strSiLAInterfaceVersion + "'" +
                                          ", o_strSiLASubDeviceClass = '" + o_strSiLASubDeviceClass + "'" +
                                          ", o_strWsdl = '" + o_strWsdl + "'",
                                          strFunctionName,
                                          gInheco_ODTC_intTraceLevel,
                                          gInheco_ODTC_strModuleName);
        return(ASWGLOBAL::BOOL::TRUE);

        DLL_ERROR:
        {
          gInheco_ODTC_arrhdlCriticalSections[i_intDeviceID].SetEvent();
          Hamilton_DriverTools::StatusTrace(Hamilton_DriverTools::ACTION::COMPLETE_WITH_ERROR,
                                            TRACE_LEVEL_RELEASE,
                                            "Unhandled exception in dll or dll missing!",
                                            strFunctionName,
                                            gInheco_ODTC_intTraceLevel,
                                            gInheco_ODTC_strModuleName);
          return(ASWGLOBAL::BOOL::FALSE);
        }
      } // GetDeviceIdentification

      //----------------------------------------------------------------------------------------------
      // function GetConfiguration
      //----------------------------------------------------------------------------------------------
      function GetConfiguration(variable i_intDeviceID,
                                variable i_strLockID,
                                variable i_intConfigLevel, 
                                variable i_strPassword, 
                                variable& o_strConfigurationXML,
                                variable& o_intSiLAReturnValue,
                                variable& o_strSiLAMessage) variable
      {
        object objDevice;
        variable strFunctionName("");

        if(Hamilton_DriverTools::ExtractFunctionName(GetFunctionName(),
                                                     strFunctionName,
                                                     gInheco_ODTC_strModuleName) == ASWGLOBAL::BOOL::FALSE) return(ASWGLOBAL::BOOL::FALSE);

        if(Hamilton_DriverTools::CheckIntegerRange(i_intDeviceID,
                                                   "i_intDeviceID",
                                                   1,
                                                   MAX_DEVICES,
                                                   strFunctionName,
                                                   gInheco_ODTC_strModuleName) == ASWGLOBAL::BOOL::FALSE) return(ASWGLOBAL::BOOL::FALSE);

        if(Hamilton_DriverTools::CheckString(i_strLockID,
                                             "i_strLockID",
                                             strFunctionName,
                                             gInheco_ODTC_strModuleName) == ASWGLOBAL::BOOL::FALSE) return(ASWGLOBAL::BOOL::FALSE);

        if(Hamilton_DriverTools::CheckIntegerRange(i_intConfigLevel,
                                                   "i_intConfigLevel",
                                                   0,
                                                   3,
                                                   strFunctionName,
                                                   gInheco_ODTC_strModuleName) == ASWGLOBAL::BOOL::FALSE) return(ASWGLOBAL::BOOL::FALSE);

        if(Hamilton_DriverTools::CheckString(i_strPassword,
                                             "i_strPassword",
                                             strFunctionName,
                                             gInheco_ODTC_strModuleName) == ASWGLOBAL::BOOL::FALSE) return(ASWGLOBAL::BOOL::FALSE);

        Hamilton_DriverTools::StatusTrace(Hamilton_DriverTools::ACTION::START,
                                          TRACE_LEVEL_DEBUG,
                                          "i_intDeviceID = " + IStr(i_intDeviceID) +
                                          ", i_strLockID = '" + i_strLockID + "'" +
                                          ", i_intConfigLevel = " + IStr(i_intConfigLevel) +
                                          ", i_strPassword = '" + i_strPassword + "'",
                                          strFunctionName,
                                          gInheco_ODTC_intTraceLevel,
                                          gInheco_ODTC_strModuleName);

        if(gInheco_ODTC_blnSimulationMode == ASWGLOBAL::BOOL::TRUE)
        {
          Hamilton_DriverTools::StatusTrace(Hamilton_DriverTools::ACTION::COMPLETE,
                                            TRACE_LEVEL_DEBUG,
                                            "Simulated",
                                            strFunctionName,
                                            gInheco_ODTC_intTraceLevel,
                                            gInheco_ODTC_strModuleName);
          return (ASWGLOBAL::BOOL::TRUE);
        }

        onerror goto DLL_ERROR;
        gInheco_ODTC_arrhdlCriticalSections[i_intDeviceID].WaitEvent(hslInfinite);
        objDevice = gInheco_ODTC_arrobjDevices.ElementAt(i_intDeviceID);
        if(!objDevice.GetConfiguration(i_strLockID,
                                       i_intConfigLevel, 
                                       i_strPassword,
                                       o_strConfigurationXML,
                                       o_intSiLAReturnValue,
                                       o_strSiLAMessage))
        {
          gInheco_ODTC_arrhdlCriticalSections[i_intDeviceID].SetEvent();
          onerror goto 0;
          Hamilton_DriverTools::StatusTrace(Hamilton_DriverTools::ACTION::COMPLETE_WITH_ERROR,
                                            TRACE_LEVEL_RELEASE,
                                            "Failed to get configuration from device " + IStr(i_intDeviceID) + ", see logfile for details !",
                                            strFunctionName,
                                            gInheco_ODTC_intTraceLevel,
                                            gInheco_ODTC_strModuleName);
          return(ASWGLOBAL::BOOL::FALSE);
        }
        gInheco_ODTC_arrhdlCriticalSections[i_intDeviceID].SetEvent();
        onerror goto 0;

        Hamilton_DriverTools::StatusTrace(Hamilton_DriverTools::ACTION::COMPLETE,
                                          TRACE_LEVEL_DEBUG,
                                          "o_strConfigurationXML = '" + o_strConfigurationXML + "'" +
                                          ", o_intSiLAReturnValue = " + IStr(o_intSiLAReturnValue) +
                                          ", o_strSiLAMessage = '^" + o_strSiLAMessage + "'",
                                          strFunctionName,
                                          gInheco_ODTC_intTraceLevel,
                                          gInheco_ODTC_strModuleName);
        return(ASWGLOBAL::BOOL::TRUE);

        DLL_ERROR:
        {
          gInheco_ODTC_arrhdlCriticalSections[i_intDeviceID].SetEvent();
          Hamilton_DriverTools::StatusTrace(Hamilton_DriverTools::ACTION::COMPLETE_WITH_ERROR,
                                            TRACE_LEVEL_RELEASE,
                                            "Unhandled exception in dll or dll missing!",
                                            strFunctionName,
                                            gInheco_ODTC_intTraceLevel,
                                            gInheco_ODTC_strModuleName);
          return(ASWGLOBAL::BOOL::FALSE);
        }
      } // GetConfiguration

      //----------------------------------------------------------------------------------------------
      // function DoContinue
      //----------------------------------------------------------------------------------------------
      function DoContinue(variable i_intDeviceID,
                          variable i_strLockID,
                          variable& o_intSiLAReturnValue,
                          variable& o_strSiLAMessage) variable
      {
        object objDevice;
        variable strFunctionName("");
        o_strSiLAMessage="in Simulation";

        if(Hamilton_DriverTools::ExtractFunctionName(GetFunctionName(),
                                                     strFunctionName,
                                                     gInheco_ODTC_strModuleName) == ASWGLOBAL::BOOL::FALSE) return(ASWGLOBAL::BOOL::FALSE);

        if(Hamilton_DriverTools::CheckIntegerRange(i_intDeviceID,
                                                   "i_intDeviceID",
                                                   1,
                                                   MAX_DEVICES,
                                                   strFunctionName,
                                                   gInheco_ODTC_strModuleName) == ASWGLOBAL::BOOL::FALSE) return(ASWGLOBAL::BOOL::FALSE);

        if(Hamilton_DriverTools::CheckString(i_strLockID,
                                             "i_strLockID",
                                             strFunctionName,
                                             gInheco_ODTC_strModuleName) == ASWGLOBAL::BOOL::FALSE) return(ASWGLOBAL::BOOL::FALSE);

        Hamilton_DriverTools::StatusTrace(Hamilton_DriverTools::ACTION::START,
                                          TRACE_LEVEL_DEBUG,
                                          "i_intDeviceID = " + IStr(i_intDeviceID) +
                                          ", i_strLockID = '" + i_strLockID + "'",
                                          strFunctionName,
                                          gInheco_ODTC_intTraceLevel,
                                          gInheco_ODTC_strModuleName);

        if(gInheco_ODTC_blnSimulationMode == ASWGLOBAL::BOOL::TRUE)
        {
          Hamilton_DriverTools::StatusTrace(Hamilton_DriverTools::ACTION::COMPLETE,
                                            TRACE_LEVEL_DEBUG,
                                            strFunctionName,
                                            "Simulated",
                                            gInheco_ODTC_intTraceLevel,
                                            gInheco_ODTC_strModuleName);
          return (ASWGLOBAL::BOOL::TRUE);
        }

        onerror goto DLL_ERROR;
        gInheco_ODTC_arrhdlCriticalSections[i_intDeviceID].WaitEvent(hslInfinite);
        objDevice = gInheco_ODTC_arrobjDevices.ElementAt(i_intDeviceID);
        if(!objDevice.DoContinue(i_strLockID,
                                 o_intSiLAReturnValue,
                                 o_strSiLAMessage))
        {
          gInheco_ODTC_arrhdlCriticalSections[i_intDeviceID].SetEvent();
          onerror goto 0;
          Hamilton_DriverTools::StatusTrace(Hamilton_DriverTools::ACTION::COMPLETE_WITH_ERROR,
                                            TRACE_LEVEL_RELEASE,
                                            "Failed to stop method on device " + IStr(i_intDeviceID) + ", see logfile for details !",
                                            strFunctionName,
                                            gInheco_ODTC_intTraceLevel,
                                            gInheco_ODTC_strModuleName);
          return(ASWGLOBAL::BOOL::FALSE);
        }
        gInheco_ODTC_arrhdlCriticalSections[i_intDeviceID].SetEvent();
        onerror goto 0;

        Hamilton_DriverTools::StatusTrace(Hamilton_DriverTools::ACTION::COMPLETE,
                                          TRACE_LEVEL_DEBUG,
                                          "o_intSiLAReturnValue = " + IStr(o_intSiLAReturnValue) +
                                          ", o_strSiLAMessage = '" + o_strSiLAMessage + "'",
                                          strFunctionName,
                                          gInheco_ODTC_intTraceLevel,
                                          gInheco_ODTC_strModuleName);
        return(ASWGLOBAL::BOOL::TRUE);

        DLL_ERROR:
        {
          gInheco_ODTC_arrhdlCriticalSections[i_intDeviceID].SetEvent();
          Hamilton_DriverTools::StatusTrace(Hamilton_DriverTools::ACTION::COMPLETE_WITH_ERROR,
                                            TRACE_LEVEL_RELEASE,
                                            "Unhandled exception in dll or dll missing!",
                                            strFunctionName,
                                            gInheco_ODTC_intTraceLevel,
                                            gInheco_ODTC_strModuleName);
          return(ASWGLOBAL::BOOL::FALSE);
        }
      } // DoContinue

      //----------------------------------------------------------------------------------------------
      // function Pause
      //----------------------------------------------------------------------------------------------
      function Pause(variable i_intDeviceID,
                     variable i_strLockID,
                     variable& o_intSiLAReturnValue,
                     variable& o_strSiLAMessage) variable
      {
        object objDevice;
        variable strFunctionName("");
        o_strSiLAMessage="in Simulation";

        if(Hamilton_DriverTools::ExtractFunctionName(GetFunctionName(),
                                                     strFunctionName,
                                                     gInheco_ODTC_strModuleName) == ASWGLOBAL::BOOL::FALSE) return(ASWGLOBAL::BOOL::FALSE);

        if(Hamilton_DriverTools::CheckIntegerRange(i_intDeviceID,
                                                   "i_intDeviceID",
                                                   1,
                                                   MAX_DEVICES,
                                                   strFunctionName,
                                                   gInheco_ODTC_strModuleName) == ASWGLOBAL::BOOL::FALSE) return(ASWGLOBAL::BOOL::FALSE);

        if(Hamilton_DriverTools::CheckString(i_strLockID,
                                             "i_strLockID",
                                             strFunctionName,
                                             gInheco_ODTC_strModuleName) == ASWGLOBAL::BOOL::FALSE) return(ASWGLOBAL::BOOL::FALSE);

        Hamilton_DriverTools::StatusTrace(Hamilton_DriverTools::ACTION::START,
                                          TRACE_LEVEL_DEBUG,
                                          "i_intDeviceID = " + IStr(i_intDeviceID) +
                                          ", i_strLockID = '" + i_strLockID + "'",
                                          strFunctionName,
                                          gInheco_ODTC_intTraceLevel,
                                          gInheco_ODTC_strModuleName);

        if(gInheco_ODTC_blnSimulationMode == ASWGLOBAL::BOOL::TRUE)
        {
          Hamilton_DriverTools::StatusTrace(Hamilton_DriverTools::ACTION::COMPLETE,
                                            TRACE_LEVEL_DEBUG,
                                            strFunctionName,
                                            "Simulated",
                                            gInheco_ODTC_intTraceLevel,
                                            gInheco_ODTC_strModuleName);
          return (ASWGLOBAL::BOOL::TRUE);
        }

        onerror goto DLL_ERROR;
        gInheco_ODTC_arrhdlCriticalSections[i_intDeviceID].WaitEvent(hslInfinite);
        objDevice = gInheco_ODTC_arrobjDevices.ElementAt(i_intDeviceID);
        if(!objDevice.Pause(i_strLockID,
                            o_intSiLAReturnValue,
                            o_strSiLAMessage))
        {
          gInheco_ODTC_arrhdlCriticalSections[i_intDeviceID].SetEvent();
          onerror goto 0;
          Hamilton_DriverTools::StatusTrace(Hamilton_DriverTools::ACTION::COMPLETE_WITH_ERROR,
                                            TRACE_LEVEL_RELEASE,
                                            "Failed to pause device " + IStr(i_intDeviceID) + ", see logfile for details !",
                                            strFunctionName,
                                            gInheco_ODTC_intTraceLevel,
                                            gInheco_ODTC_strModuleName);
          return(ASWGLOBAL::BOOL::FALSE);
        }
        gInheco_ODTC_arrhdlCriticalSections[i_intDeviceID].SetEvent();
        onerror goto 0;

        Hamilton_DriverTools::StatusTrace(Hamilton_DriverTools::ACTION::COMPLETE,
                                          TRACE_LEVEL_DEBUG,
                                          "o_intSiLAReturnValue = " + IStr(o_intSiLAReturnValue) +
                                          ", o_strSiLAMessage = '" + o_strSiLAMessage + "'",
                                          strFunctionName,
                                          gInheco_ODTC_intTraceLevel,
                                          gInheco_ODTC_strModuleName);
        return(ASWGLOBAL::BOOL::TRUE);

        DLL_ERROR:
        {
          gInheco_ODTC_arrhdlCriticalSections[i_intDeviceID].SetEvent();
          Hamilton_DriverTools::StatusTrace(Hamilton_DriverTools::ACTION::COMPLETE_WITH_ERROR,
                                            TRACE_LEVEL_RELEASE,
                                            "Unhandled exception in dll or dll missing!",
                                            strFunctionName,
                                            gInheco_ODTC_intTraceLevel,
                                            gInheco_ODTC_strModuleName);
          return(ASWGLOBAL::BOOL::FALSE);
        }
      } // Pause

      //----------------------------------------------------------------------------------------------
      // function DisableTemperatureEvent
      //----------------------------------------------------------------------------------------------
      function DisableTemperatureEvent(variable i_intDeviceID,
                                       variable i_strLockID,
                                       variable& o_intSiLAReturnValue,
                                       variable& o_strSiLAMessage) variable
      {
        object objDevice;
        variable strFunctionName("");
        o_strSiLAMessage="in Simulation";

        if(Hamilton_DriverTools::ExtractFunctionName(GetFunctionName(),
                                                     strFunctionName,
                                                     gInheco_ODTC_strModuleName) == ASWGLOBAL::BOOL::FALSE) return(ASWGLOBAL::BOOL::FALSE);

        if(Hamilton_DriverTools::CheckIntegerRange(i_intDeviceID,
                                                   "i_intDeviceID",
                                                   1,
                                                   MAX_DEVICES,
                                                   strFunctionName,
                                                   gInheco_ODTC_strModuleName) == ASWGLOBAL::BOOL::FALSE) return(ASWGLOBAL::BOOL::FALSE);

        if(Hamilton_DriverTools::CheckString(i_strLockID,
                                             "i_strLockID",
                                             strFunctionName,
                                             gInheco_ODTC_strModuleName) == ASWGLOBAL::BOOL::FALSE) return(ASWGLOBAL::BOOL::FALSE);

        Hamilton_DriverTools::StatusTrace(Hamilton_DriverTools::ACTION::START,
                                          TRACE_LEVEL_DEBUG,
                                          "i_intDeviceID = " + IStr(i_intDeviceID) +
                                          ", i_strLockID = '" + i_strLockID + "'",
                                          strFunctionName,
                                          gInheco_ODTC_intTraceLevel,
                                          gInheco_ODTC_strModuleName);

        if(gInheco_ODTC_blnSimulationMode == ASWGLOBAL::BOOL::TRUE)
        {
          Hamilton_DriverTools::StatusTrace(Hamilton_DriverTools::ACTION::COMPLETE,
                                            TRACE_LEVEL_DEBUG,
                                            strFunctionName,
                                            "Simulated",
                                            gInheco_ODTC_intTraceLevel,
                                            gInheco_ODTC_strModuleName);
          return (ASWGLOBAL::BOOL::TRUE);
        }

        onerror goto DLL_ERROR;
        gInheco_ODTC_arrhdlCriticalSections[i_intDeviceID].WaitEvent(hslInfinite);
        objDevice = gInheco_ODTC_arrobjDevices.ElementAt(i_intDeviceID);

        if(!objDevice.SwitchDataEvents(i_strLockID,
                                       hslFalse,
                                       o_intSiLAReturnValue,
                                       o_strSiLAMessage))
        {
          gInheco_ODTC_arrhdlCriticalSections[i_intDeviceID].SetEvent();
          onerror goto 0;
          Hamilton_DriverTools::StatusTrace(Hamilton_DriverTools::ACTION::COMPLETE_WITH_ERROR,
                                            TRACE_LEVEL_RELEASE,
                                            "Failed to disable data events, see logfile for details !",
                                            strFunctionName,
                                            gInheco_ODTC_intTraceLevel,
                                            gInheco_ODTC_strModuleName);
          return(ASWGLOBAL::BOOL::FALSE);
        }

        gInheco_ODTC_arrhdlCriticalSections[i_intDeviceID].SetEvent();
        onerror goto 0;

        Hamilton_DriverTools::StatusTrace(Hamilton_DriverTools::ACTION::COMPLETE,
                                          TRACE_LEVEL_DEBUG,
                                          "o_intSiLAReturnValue = " + IStr(o_intSiLAReturnValue) +
                                          ", o_strSiLAMessage = '" + o_strSiLAMessage + "'",
                                          strFunctionName,
                                          gInheco_ODTC_intTraceLevel,
                                          gInheco_ODTC_strModuleName);
        return(ASWGLOBAL::BOOL::TRUE);

        DLL_ERROR:
        {
          gInheco_ODTC_arrhdlCriticalSections[i_intDeviceID].SetEvent();
          Hamilton_DriverTools::StatusTrace(Hamilton_DriverTools::ACTION::COMPLETE_WITH_ERROR,
                                            TRACE_LEVEL_RELEASE,
                                            "Unhandled exception in dll or dll missing!",
                                            strFunctionName,
                                            gInheco_ODTC_intTraceLevel,
                                            gInheco_ODTC_strModuleName);
          return(ASWGLOBAL::BOOL::FALSE);
        }
      } // Pause

      //----------------------------------------------------------------------------------------------
      // function SetParameters
      //----------------------------------------------------------------------------------------------
      function SetParameters(variable i_intDeviceID,
                             variable i_strLockID,
                             variable i_strParameterName,
                             variable i_strParameterType,
                             variable i_strParameterValue,
                             variable& o_intSiLAReturnValue,
                             variable& o_strSiLAMessage) variable
      {
        object objDevice;
        variable strFunctionName("");
        o_strSiLAMessage = "in Simulation";

        if(Hamilton_DriverTools::ExtractFunctionName(GetFunctionName(),
                                                     strFunctionName,
                                                     gInheco_ODTC_strModuleName) == ASWGLOBAL::BOOL::FALSE) return(ASWGLOBAL::BOOL::FALSE);

        if(Hamilton_DriverTools::CheckIntegerRange(i_intDeviceID,
                                                   "i_intDeviceID",
                                                   1,
                                                   MAX_DEVICES,
                                                   strFunctionName,
                                                   gInheco_ODTC_strModuleName) == ASWGLOBAL::BOOL::FALSE) return(ASWGLOBAL::BOOL::FALSE);

        if(Hamilton_DriverTools::CheckString(i_strLockID,
                                             "i_strLockID",
                                             strFunctionName,
                                             gInheco_ODTC_strModuleName) == ASWGLOBAL::BOOL::FALSE) return(ASWGLOBAL::BOOL::FALSE);

        if(Hamilton_DriverTools::CheckString(i_strParameterName,
                                            "i_strParameterName",
                                            strFunctionName,
                                            gInheco_ODTC_strModuleName) == ASWGLOBAL::BOOL::FALSE) return(ASWGLOBAL::BOOL::FALSE);

        if(Hamilton_DriverTools::CheckString(i_strParameterType,
                                            "i_strParameterType",
                                            strFunctionName,
                                            gInheco_ODTC_strModuleName) == ASWGLOBAL::BOOL::FALSE) return(ASWGLOBAL::BOOL::FALSE);

        if(Hamilton_DriverTools::CheckString(i_strParameterValue,
                                            "i_strParameterValue",
                                            strFunctionName,
                                            gInheco_ODTC_strModuleName) == ASWGLOBAL::BOOL::FALSE) return(ASWGLOBAL::BOOL::FALSE);

        Hamilton_DriverTools::StatusTrace(Hamilton_DriverTools::ACTION::START,
                                          TRACE_LEVEL_DEBUG,
                                          "i_intDeviceID = " + IStr(i_intDeviceID) +
                                          ", i_strLockID = '" + i_strLockID + "'" +
                                          ", i_strParameterName = '" + i_strParameterName + "'" +
                                          ", i_strParameterType = '" + i_strParameterType + "'" +
                                          ", i_strParameterValue = '" + i_strParameterValue + "'",
                                          strFunctionName,
                                          gInheco_ODTC_intTraceLevel,
                                          gInheco_ODTC_strModuleName);

        if(gInheco_ODTC_blnSimulationMode == ASWGLOBAL::BOOL::TRUE)
        {
          Hamilton_DriverTools::StatusTrace(Hamilton_DriverTools::ACTION::COMPLETE,
                                            TRACE_LEVEL_DEBUG,
                                            strFunctionName,
                                            "Simulated",
                                            gInheco_ODTC_intTraceLevel,
                                            gInheco_ODTC_strModuleName);
          return (ASWGLOBAL::BOOL::TRUE);
        }

        onerror goto DLL_ERROR;
        gInheco_ODTC_arrhdlCriticalSections[i_intDeviceID].WaitEvent(hslInfinite);
        objDevice = gInheco_ODTC_arrobjDevices.ElementAt(i_intDeviceID);
        if(!objDevice.SetParameters(i_strLockID,
                                    i_strParameterName,
                                    i_strParameterType,
                                    i_strParameterValue,
                                    o_intSiLAReturnValue,
                                    o_strSiLAMessage))
        {
          gInheco_ODTC_arrhdlCriticalSections[i_intDeviceID].SetEvent();
          onerror goto 0;
          Hamilton_DriverTools::StatusTrace(Hamilton_DriverTools::ACTION::COMPLETE_WITH_ERROR,
                                            TRACE_LEVEL_RELEASE,
                                            "Failed to set parameters on device " + IStr(i_intDeviceID) + ", see logfile for details !",
                                            strFunctionName,
                                            gInheco_ODTC_intTraceLevel,
                                            gInheco_ODTC_strModuleName);
          return(ASWGLOBAL::BOOL::FALSE);
        }
        gInheco_ODTC_arrhdlCriticalSections[i_intDeviceID].SetEvent();
        onerror goto 0;

        Hamilton_DriverTools::StatusTrace(Hamilton_DriverTools::ACTION::COMPLETE,
                                          TRACE_LEVEL_DEBUG,
                                          "o_intSiLAReturnValue = " + IStr(o_intSiLAReturnValue) +
                                          ", o_strSiLAMessage = '" + o_strSiLAMessage + "'",
                                          strFunctionName,
                                          gInheco_ODTC_intTraceLevel,
                                          gInheco_ODTC_strModuleName);
        return(ASWGLOBAL::BOOL::TRUE);

        DLL_ERROR:
        {
          gInheco_ODTC_arrhdlCriticalSections[i_intDeviceID].SetEvent();
          Hamilton_DriverTools::StatusTrace(Hamilton_DriverTools::ACTION::COMPLETE_WITH_ERROR,
                                            TRACE_LEVEL_RELEASE,
                                            "Unhandled exception in dll or dll missing!",
                                            strFunctionName,
                                            gInheco_ODTC_intTraceLevel,
                                            gInheco_ODTC_strModuleName);
          return(ASWGLOBAL::BOOL::FALSE);
        }
      } // SetParameters

      //----------------------------------------------------------------------------------------------
      // function SetLogLevel
      //----------------------------------------------------------------------------------------------
      function SetLogLevel(variable i_intDeviceID,
                           variable i_strLockID,
                           variable i_strLogLevel,
                           variable &o_intSiLAReturnValue,
                           variable &o_strSiLAMessage) variable
      {
        object objDevice;
        variable strFunctionName("");

        if(Hamilton_DriverTools::ExtractFunctionName(GetFunctionName(),
                                                     strFunctionName,
                                                     gInheco_ODTC_strModuleName) == ASWGLOBAL::BOOL::FALSE) return(ASWGLOBAL::BOOL::FALSE);

        if(Hamilton_DriverTools::CheckIntegerRange(i_intDeviceID,
                                                   "i_intDeviceID",
                                                   1,
                                                   MAX_DEVICES,
                                                   strFunctionName,
                                                   gInheco_ODTC_strModuleName) == ASWGLOBAL::BOOL::FALSE) return(ASWGLOBAL::BOOL::FALSE);

        if(Hamilton_DriverTools::CheckString(i_strLockID,
                                             "i_strLockID",
                                             strFunctionName,
                                             gInheco_ODTC_strModuleName) == ASWGLOBAL::BOOL::FALSE) return(ASWGLOBAL::BOOL::FALSE);

        if(Hamilton_DriverTools::CheckString(i_strLogLevel,
                                             "i_strLogLevel",
                                             strFunctionName,
                                             gInheco_ODTC_strModuleName) == ASWGLOBAL::BOOL::FALSE) return(ASWGLOBAL::BOOL::FALSE);

        Hamilton_DriverTools::StatusTrace(Hamilton_DriverTools::ACTION::START,
                                          TRACE_LEVEL_DEBUG,
                                          "i_intDeviceID = " + IStr(i_intDeviceID) +
                                          ", i_strLockID = '" + i_strLockID + "'" +
                                          ", i_strLogLevel = '" + i_strLogLevel + "'",
                                          strFunctionName,
                                          gInheco_ODTC_intTraceLevel,
                                          gInheco_ODTC_strModuleName);

        if(gInheco_ODTC_blnSimulationMode == ASWGLOBAL::BOOL::TRUE)
        {
          Hamilton_DriverTools::StatusTrace(Hamilton_DriverTools::ACTION::COMPLETE,
                                            TRACE_LEVEL_DEBUG,
                                            "Simulated",
                                            strFunctionName,
                                            gInheco_ODTC_intTraceLevel,
                                            gInheco_ODTC_strModuleName);
          return (ASWGLOBAL::BOOL::TRUE);
        }

        onerror goto DLL_ERROR;
        gInheco_ODTC_arrhdlCriticalSections[i_intDeviceID].WaitEvent(hslInfinite);
        objDevice = gInheco_ODTC_arrobjDevices.ElementAt(i_intDeviceID);
        if(!objDevice.SetLogLevel(i_strLockID,
                                  i_strLogLevel,
                                  o_intSiLAReturnValue,
                                  o_strSiLAMessage))
        {
          gInheco_ODTC_arrhdlCriticalSections[i_intDeviceID].SetEvent();
          onerror goto 0;
          Hamilton_DriverTools::StatusTrace(Hamilton_DriverTools::ACTION::COMPLETE_WITH_ERROR,
                                            TRACE_LEVEL_RELEASE,
                                            "Failed to set log level of device " + IStr(i_intDeviceID) + ", see logfile for details !",
                                            strFunctionName,
                                            gInheco_ODTC_intTraceLevel,
                                            gInheco_ODTC_strModuleName);
          return(ASWGLOBAL::BOOL::FALSE);
        }
        gInheco_ODTC_arrhdlCriticalSections[i_intDeviceID].SetEvent();
        onerror goto 0;

        Hamilton_DriverTools::StatusTrace(Hamilton_DriverTools::ACTION::COMPLETE,
                                          TRACE_LEVEL_DEBUG,
                                          "o_intSiLAReturnValue = " + IStr(o_intSiLAReturnValue) +
                                          ", o_strSiLAMessage = '^" + o_strSiLAMessage + "'",
                                          strFunctionName,
                                          gInheco_ODTC_intTraceLevel,
                                          gInheco_ODTC_strModuleName);
        return(ASWGLOBAL::BOOL::TRUE);

        DLL_ERROR:
        {
          gInheco_ODTC_arrhdlCriticalSections[i_intDeviceID].SetEvent();
          Hamilton_DriverTools::StatusTrace(Hamilton_DriverTools::ACTION::COMPLETE_WITH_ERROR,
                                            TRACE_LEVEL_RELEASE,
                                            "Unhandled exception in dll or dll missing!",
                                            strFunctionName,
                                            gInheco_ODTC_intTraceLevel,
                                            gInheco_ODTC_strModuleName);
          return(ASWGLOBAL::BOOL::FALSE);
        }
      } // SetLogLevel

      //----------------------------------------------------------------------------------------------
      // function RegisterStatusEventURL
      //----------------------------------------------------------------------------------------------
      function RegisterStatusEventURL(variable i_intDeviceID,
                                      variable i_strLockID, 
                                      variable i_strURL, 
                                      variable i_strEventInterVal,
                                      variable& o_intSiLAReturnValue,
                                      variable& o_strSiLAMessage) variable
      {
        object objDevice;
        variable strFunctionName("");
        o_strSiLAMessage="in Simulation";

        if(Hamilton_DriverTools::ExtractFunctionName(GetFunctionName(),
                                                     strFunctionName,
                                                     gInheco_ODTC_strModuleName) == ASWGLOBAL::BOOL::FALSE) return(ASWGLOBAL::BOOL::FALSE);

        if(Hamilton_DriverTools::CheckIntegerRange(i_intDeviceID,
                                                   "i_intDeviceID",
                                                   1,
                                                   MAX_DEVICES,
                                                   strFunctionName,
                                                   gInheco_ODTC_strModuleName) == ASWGLOBAL::BOOL::FALSE) return(ASWGLOBAL::BOOL::FALSE);

        if(Hamilton_DriverTools::CheckString(i_strLockID,
                                             "i_strLockID",
                                             strFunctionName,
                                             gInheco_ODTC_strModuleName) == ASWGLOBAL::BOOL::FALSE) return(ASWGLOBAL::BOOL::FALSE);

        if(Hamilton_DriverTools::CheckString(i_strURL,
                                             "i_strURL",
                                             strFunctionName,
                                             gInheco_ODTC_strModuleName) == ASWGLOBAL::BOOL::FALSE) return(ASWGLOBAL::BOOL::FALSE);

        if(Hamilton_DriverTools::CheckString(i_strEventInterVal,
                                             "i_strEventInterVal",
                                             strFunctionName,
                                             gInheco_ODTC_strModuleName) == ASWGLOBAL::BOOL::FALSE) return(ASWGLOBAL::BOOL::FALSE);

        Hamilton_DriverTools::StatusTrace(Hamilton_DriverTools::ACTION::START,
                                          TRACE_LEVEL_DEBUG,
                                          "i_intDeviceID = " + IStr(i_intDeviceID) +
                                          ", i_strLockID = '" + i_strLockID + "'" +
                                          ", i_strURL = '" + i_strURL + "'" +
                                          ", i_strEventInterVal = '" + i_strEventInterVal + "'",
                                          strFunctionName,
                                          gInheco_ODTC_intTraceLevel,
                                          gInheco_ODTC_strModuleName);

        if(gInheco_ODTC_blnSimulationMode == ASWGLOBAL::BOOL::TRUE)
        {
          Hamilton_DriverTools::StatusTrace(Hamilton_DriverTools::ACTION::COMPLETE,
                                            TRACE_LEVEL_DEBUG,
                                            strFunctionName,
                                            "Simulated",
                                            gInheco_ODTC_intTraceLevel,
                                            gInheco_ODTC_strModuleName);
          return (ASWGLOBAL::BOOL::TRUE);
        }

        onerror goto DLL_ERROR;
        gInheco_ODTC_arrhdlCriticalSections[i_intDeviceID].WaitEvent(hslInfinite);
        objDevice = gInheco_ODTC_arrobjDevices.ElementAt(i_intDeviceID);
        if(!objDevice.RegisterStatusEventURL(i_strLockID, 
                                             i_strURL, 
                                             i_strEventInterVal,
                                             o_intSiLAReturnValue,
                                             o_strSiLAMessage))
        {
          gInheco_ODTC_arrhdlCriticalSections[i_intDeviceID].SetEvent();
          onerror goto 0;
          Hamilton_DriverTools::StatusTrace(Hamilton_DriverTools::ACTION::COMPLETE_WITH_ERROR,
                                            TRACE_LEVEL_RELEASE,
                                            "Failed to register status event URL for device " + IStr(i_intDeviceID) + ", see logfile for details !",
                                            strFunctionName,
                                            gInheco_ODTC_intTraceLevel,
                                            gInheco_ODTC_strModuleName);
          return(ASWGLOBAL::BOOL::FALSE);
        }
        gInheco_ODTC_arrhdlCriticalSections[i_intDeviceID].SetEvent();
        onerror goto 0;

        Hamilton_DriverTools::StatusTrace(Hamilton_DriverTools::ACTION::COMPLETE,
                                          TRACE_LEVEL_DEBUG,
                                          "o_intSiLAReturnValue = " + IStr(o_intSiLAReturnValue) +
                                          ", o_strSiLAMessage = '" + o_strSiLAMessage + "'",
                                          strFunctionName,
                                          gInheco_ODTC_intTraceLevel,
                                          gInheco_ODTC_strModuleName);
        return(ASWGLOBAL::BOOL::TRUE);

        DLL_ERROR:
        {
          gInheco_ODTC_arrhdlCriticalSections[i_intDeviceID].SetEvent();
          Hamilton_DriverTools::StatusTrace(Hamilton_DriverTools::ACTION::COMPLETE_WITH_ERROR,
                                            TRACE_LEVEL_RELEASE,
                                            "Unhandled exception in dll or dll missing!",
                                            strFunctionName,
                                            gInheco_ODTC_intTraceLevel,
                                            gInheco_ODTC_strModuleName);
          return(ASWGLOBAL::BOOL::FALSE);
        }
      } // RegisterStatusEventURL

      //----------------------------------------------------------------------------------------------
      // function UnregisterStatusEventURL
      //----------------------------------------------------------------------------------------------
      function UnregisterStatusEventURL(variable i_intDeviceID,
                                        variable i_strLockID,
                                        variable i_strURL,
                                        variable& o_intSiLAReturnValue,
                                        variable& o_strSiLAMessage) variable
      {
        object objDevice;
        variable strFunctionName("");
        o_strSiLAMessage="in Simulation";

        if(Hamilton_DriverTools::ExtractFunctionName(GetFunctionName(),
                                                     strFunctionName,
                                                     gInheco_ODTC_strModuleName) == ASWGLOBAL::BOOL::FALSE) return(ASWGLOBAL::BOOL::FALSE);

        if(Hamilton_DriverTools::CheckIntegerRange(i_intDeviceID,
                                                   "i_intDeviceID",
                                                   1,
                                                   MAX_DEVICES,
                                                   strFunctionName,
                                                   gInheco_ODTC_strModuleName) == ASWGLOBAL::BOOL::FALSE) return(ASWGLOBAL::BOOL::FALSE);

        if(Hamilton_DriverTools::CheckString(i_strLockID,
                                             "i_strLockID",
                                             strFunctionName,
                                             gInheco_ODTC_strModuleName) == ASWGLOBAL::BOOL::FALSE) return(ASWGLOBAL::BOOL::FALSE);

        if(Hamilton_DriverTools::CheckString(i_strURL,
                                             "i_strURL",
                                             strFunctionName,
                                             gInheco_ODTC_strModuleName) == ASWGLOBAL::BOOL::FALSE) return(ASWGLOBAL::BOOL::FALSE);

        Hamilton_DriverTools::StatusTrace(Hamilton_DriverTools::ACTION::START,
                                          TRACE_LEVEL_DEBUG,
                                          "i_intDeviceID = " + IStr(i_intDeviceID) +
                                          ", i_strLockID = '" + i_strLockID + "'" +
                                          ", i_strURL = '" + i_strURL + "'",
                                          strFunctionName,
                                          gInheco_ODTC_intTraceLevel,
                                          gInheco_ODTC_strModuleName);

        if(gInheco_ODTC_blnSimulationMode == ASWGLOBAL::BOOL::TRUE)
        {
          Hamilton_DriverTools::StatusTrace(Hamilton_DriverTools::ACTION::COMPLETE,
                                            TRACE_LEVEL_DEBUG,
                                            strFunctionName,
                                            "Simulated",
                                            gInheco_ODTC_intTraceLevel,
                                            gInheco_ODTC_strModuleName);
          return (ASWGLOBAL::BOOL::TRUE);
        }

        onerror goto DLL_ERROR;
        gInheco_ODTC_arrhdlCriticalSections[i_intDeviceID].WaitEvent(hslInfinite);
        objDevice = gInheco_ODTC_arrobjDevices.ElementAt(i_intDeviceID);
        if(!objDevice.UnregisterStatusEventURL(i_strLockID,
                                               i_strURL, 
                                               o_intSiLAReturnValue,
                                               o_strSiLAMessage))
        {
          gInheco_ODTC_arrhdlCriticalSections[i_intDeviceID].SetEvent();
          onerror goto 0;
          Hamilton_DriverTools::StatusTrace(Hamilton_DriverTools::ACTION::COMPLETE_WITH_ERROR,
                                            TRACE_LEVEL_RELEASE,
                                            "Failed to unregister status event URL from device " + IStr(i_intDeviceID) + ", see logfile for details !",
                                            strFunctionName,
                                            gInheco_ODTC_intTraceLevel,
                                            gInheco_ODTC_strModuleName);
          return(ASWGLOBAL::BOOL::FALSE);
        }
        gInheco_ODTC_arrhdlCriticalSections[i_intDeviceID].SetEvent();
        onerror goto 0;

        Hamilton_DriverTools::StatusTrace(Hamilton_DriverTools::ACTION::COMPLETE,
                                          TRACE_LEVEL_DEBUG,
                                          "o_intSiLAReturnValue = " + IStr(o_intSiLAReturnValue) +
                                          ", o_strSiLAMessage = '" + o_strSiLAMessage + "'",
                                          strFunctionName,
                                          gInheco_ODTC_intTraceLevel,
                                          gInheco_ODTC_strModuleName);
        return(ASWGLOBAL::BOOL::TRUE);

        DLL_ERROR:
        {
          gInheco_ODTC_arrhdlCriticalSections[i_intDeviceID].SetEvent();
          Hamilton_DriverTools::StatusTrace(Hamilton_DriverTools::ACTION::COMPLETE_WITH_ERROR,
                                            TRACE_LEVEL_RELEASE,
                                            "Unhandled exception in dll or dll missing!",
                                            strFunctionName,
                                            gInheco_ODTC_intTraceLevel,
                                            gInheco_ODTC_strModuleName);
          return(ASWGLOBAL::BOOL::FALSE);
        }
      } // UnregisterStatusEventURL

      //----------------------------------------------------------------------------------------------
      // function GetLastData
      //----------------------------------------------------------------------------------------------
      private function GetLastData(variable i_intDeviceID,
                                   variable i_strLockID,
                                   variable &o_strResult,
                                   variable &o_intSiLAReturnValue,
                                   variable &o_strSiLAMessage) variable
      {
        object objDevice;
        variable strFunctionName("");
        o_strSiLAMessage="in Simulation";

        if(Hamilton_DriverTools::ExtractFunctionName(GetFunctionName(),
                                                     strFunctionName,
                                                     gInheco_ODTC_strModuleName) == ASWGLOBAL::BOOL::FALSE) return(ASWGLOBAL::BOOL::FALSE);

        if(Hamilton_DriverTools::CheckIntegerRange(i_intDeviceID,
                                                   "i_intDeviceID",
                                                   1,
                                                   MAX_DEVICES,
                                                   strFunctionName,
                                                   gInheco_ODTC_strModuleName) == ASWGLOBAL::BOOL::FALSE) return(ASWGLOBAL::BOOL::FALSE);

        if(Hamilton_DriverTools::CheckString(i_strLockID,
                                             "i_strLockID",
                                             strFunctionName,
                                             gInheco_ODTC_strModuleName) == ASWGLOBAL::BOOL::FALSE) return(ASWGLOBAL::BOOL::FALSE);

        Hamilton_DriverTools::StatusTrace(Hamilton_DriverTools::ACTION::START,
                                          TRACE_LEVEL_DEBUG,
                                          "i_intDeviceID = " + IStr(i_intDeviceID) +
                                          ", i_strLockID = '" + i_strLockID + "'",
                                          strFunctionName,
                                          gInheco_ODTC_intTraceLevel,
                                          gInheco_ODTC_strModuleName);

        if(gInheco_ODTC_blnSimulationMode == ASWGLOBAL::BOOL::TRUE)
        {
          Hamilton_DriverTools::StatusTrace(Hamilton_DriverTools::ACTION::COMPLETE,
                                            TRACE_LEVEL_DEBUG,
                                            strFunctionName,
                                            "Simulated",
                                            gInheco_ODTC_intTraceLevel,
                                            gInheco_ODTC_strModuleName);
          return (ASWGLOBAL::BOOL::TRUE);
        }

        onerror goto DLL_ERROR;
        gInheco_ODTC_arrhdlCriticalSections[i_intDeviceID].WaitEvent(hslInfinite);
        objDevice = gInheco_ODTC_arrobjDevices.ElementAt(i_intDeviceID);
        if(!objDevice.GetLastData(i_strLockID,
                                  o_strResult,
                                  o_intSiLAReturnValue,
                                  o_strSiLAMessage))
        {
          gInheco_ODTC_arrhdlCriticalSections[i_intDeviceID].SetEvent();
          onerror goto 0;
          Hamilton_DriverTools::StatusTrace(Hamilton_DriverTools::ACTION::COMPLETE_WITH_ERROR,
                                            TRACE_LEVEL_RELEASE,
                                            "Failed to get last data from device " + IStr(i_intDeviceID) + ", see logfile for details !",
                                            strFunctionName,
                                            gInheco_ODTC_intTraceLevel,
                                            gInheco_ODTC_strModuleName);
          return(ASWGLOBAL::BOOL::FALSE);
        }
        gInheco_ODTC_arrhdlCriticalSections[i_intDeviceID].SetEvent();
        onerror goto 0;

        Hamilton_DriverTools::StatusTrace(Hamilton_DriverTools::ACTION::COMPLETE,
                                          TRACE_LEVEL_DEBUG,
                                          "o_strResult = '" + o_strResult + "'" +
                                          ", o_intSiLAReturnValue = " + IStr(o_intSiLAReturnValue) +
                                          ", o_strSiLAMessage = '" + o_strSiLAMessage + "'",
                                          strFunctionName,
                                          gInheco_ODTC_intTraceLevel,
                                          gInheco_ODTC_strModuleName);
        return(ASWGLOBAL::BOOL::TRUE);

        DLL_ERROR:
        {
          gInheco_ODTC_arrhdlCriticalSections[i_intDeviceID].SetEvent();
          Hamilton_DriverTools::StatusTrace(Hamilton_DriverTools::ACTION::COMPLETE_WITH_ERROR,
                                            TRACE_LEVEL_RELEASE,
                                            "Unhandled exception in dll or dll missing!",
                                            strFunctionName,
                                            gInheco_ODTC_intTraceLevel,
                                            gInheco_ODTC_strModuleName);
          return(ASWGLOBAL::BOOL::FALSE);
        }
      } // GetLastData
    } // namespace Advanced

    //----------------------------------------------------------------------------------------------
    // private function _InitializeLibrary
    //----------------------------------------------------------------------------------------------
    private function _InitializeLibrary(variable i_strCallingFunctionName) variable
    {
      variable intActualPosition(0);
      variable arrstrDefaultErrors[];

      if(gInheco_ODTC_blnInitialized) return(hslTrue);

      onerror goto DLL_ERROR;
      if(gInheco_ODTC_objDevice_01.CreateObject("Inheco.ODTCInterface",hslTrue) == 0)
      {
        Hamilton_DriverTools::StatusTrace(Hamilton_DriverTools::ACTION::COMPLETE_WITH_ERROR,
                                         TRACE_LEVEL_RELEASE,
                                         "Failed to create the Automation interface !",
                                         i_strCallingFunctionName,
                                         gInheco_ODTC_intTraceLevel,
                                         gInheco_ODTC_strModuleName);
        return(hslFalse);
      }
      if(!gInheco_ODTC_objDevice_01.SetInstance(1))
      {
        Hamilton_DriverTools::StatusTrace(Hamilton_DriverTools::ACTION::COMPLETE_WITH_ERROR,
                                          TRACE_LEVEL_RELEASE,
                                          "Failed to set instance number to 1, see logfile for details !",
                                          i_strCallingFunctionName,
                                          gInheco_ODTC_intTraceLevel,
                                          gInheco_ODTC_strModuleName);
        return(hslFalse);
      }
      gInheco_ODTC_arrobjDevices[1] = gInheco_ODTC_objDevice_01;

      if(gInheco_ODTC_objDevice_02.CreateObject("Inheco.ODTCInterface",hslTrue) == 0)
      {
        Hamilton_DriverTools::StatusTrace(Hamilton_DriverTools::ACTION::COMPLETE_WITH_ERROR,
                                         TRACE_LEVEL_RELEASE,
                                         "Failed to create the Automation interface !",
                                         i_strCallingFunctionName,
                                         gInheco_ODTC_intTraceLevel,
                                         gInheco_ODTC_strModuleName);
        return(hslFalse);
      }
      if(!gInheco_ODTC_objDevice_02.SetInstance(2))
      {
        Hamilton_DriverTools::StatusTrace(Hamilton_DriverTools::ACTION::COMPLETE_WITH_ERROR,
                                          TRACE_LEVEL_RELEASE,
                                          "Failed to set instance number to 2, see logfile for details !",
                                          i_strCallingFunctionName,
                                          gInheco_ODTC_intTraceLevel,
                                          gInheco_ODTC_strModuleName);
        return(hslFalse);
      }
      gInheco_ODTC_arrobjDevices[2] = gInheco_ODTC_objDevice_02;

      if(gInheco_ODTC_objDevice_03.CreateObject("Inheco.ODTCInterface",hslTrue) == 0)
      {
        Hamilton_DriverTools::StatusTrace(Hamilton_DriverTools::ACTION::COMPLETE_WITH_ERROR,
                                         TRACE_LEVEL_RELEASE,
                                         "Failed to create the Automation interface !",
                                         i_strCallingFunctionName,
                                         gInheco_ODTC_intTraceLevel,
                                         gInheco_ODTC_strModuleName);
        return(hslFalse);
      }
      if(!gInheco_ODTC_objDevice_03.SetInstance(3))
      {
        Hamilton_DriverTools::StatusTrace(Hamilton_DriverTools::ACTION::COMPLETE_WITH_ERROR,
                                          TRACE_LEVEL_RELEASE,
                                          "Failed to set instance number to 3, see logfile for details !",
                                          i_strCallingFunctionName,
                                          gInheco_ODTC_intTraceLevel,
                                          gInheco_ODTC_strModuleName);
        return(hslFalse);
      }
      gInheco_ODTC_arrobjDevices[3] = gInheco_ODTC_objDevice_03;

      if(gInheco_ODTC_objDevice_04.CreateObject("Inheco.ODTCInterface",hslTrue) == 0)
      {
        Hamilton_DriverTools::StatusTrace(Hamilton_DriverTools::ACTION::COMPLETE_WITH_ERROR,
                                         TRACE_LEVEL_RELEASE,
                                         "Failed to create the Automation interface !",
                                         i_strCallingFunctionName,
                                         gInheco_ODTC_intTraceLevel,
                                         gInheco_ODTC_strModuleName);
        return(hslFalse);
      }
      if(!gInheco_ODTC_objDevice_04.SetInstance(4))
      {
        Hamilton_DriverTools::StatusTrace(Hamilton_DriverTools::ACTION::COMPLETE_WITH_ERROR,
                                          TRACE_LEVEL_RELEASE,
                                          "Failed to set instance number to 4, see logfile for details !",
                                          i_strCallingFunctionName,
                                          gInheco_ODTC_intTraceLevel,
                                          gInheco_ODTC_strModuleName);
        return(hslFalse);
      }
      gInheco_ODTC_arrobjDevices[4] = gInheco_ODTC_objDevice_04;
      onerror goto 0;

      // set default errors
      arrstrDefaultErrors.SetSize(0);
      arrstrDefaultErrors.AddAsLast(ERROR_DEVBUSY);
      arrstrDefaultErrors.AddAsLast(ERROR_ONLOCKID);
      arrstrDefaultErrors.AddAsLast(ERROR_REQUESTID);
      arrstrDefaultErrors.AddAsLast(ERROR_COMMANDNOTALLOWED);
      arrstrDefaultErrors.AddAsLast(ERROR_INVALIDCOMANDPARAM);
      arrstrDefaultErrors.AddAsLast(ERROR_HARDWARE);
      arrstrDefaultErrors.AddAsLast(ERROR_COMMUNICATION);
      arrstrDefaultErrors.AddAsLast(ERROR_PMSSOFTWARE);
      arrstrDefaultErrors.AddAsLast(ERROR_DEVICEPLUGIN);
      arrstrDefaultErrors.AddAsLast(ERROR_HARDWARERUN);
      arrstrDefaultErrors.AddAsLast(ERROR_CONNECTION_ODTC_PCU);
      arrstrDefaultErrors.AddAsLast(ERROR_DOOR);
      arrstrDefaultErrors.AddAsLast(ERROR_ODTCMETHODERROR);
      arrstrDefaultErrors.AddAsLast(ERROR_UNEXPECTEDBUSERROR);
      arrstrDefaultErrors.AddAsLast(ERROR_ACPOWERLOSS);

      // set critical section events once
      for(intActualPosition = 1; intActualPosition <= MAX_DEVICES; intActualPosition++)
      {
        gInheco_ODTC_arrhdlCriticalSections[intActualPosition].SetEvent();
        gInheco_ODTC_arrstrIPAddresses[intActualPosition] = "";
      }

      gInheco_ODTC_blnInitialized = hslTrue;

      return(hslTrue);

      DLL_ERROR:
      {
        Hamilton_DriverTools::StatusTrace(Hamilton_DriverTools::ACTION::COMPLETE_WITH_ERROR,
                                          TRACE_LEVEL_RELEASE,
                                          "Unhandled exception in dll or dll missing!",
                                          i_strCallingFunctionName,
                                          gInheco_ODTC_intTraceLevel,
                                          gInheco_ODTC_strModuleName);
        return(hslFalse);
      }
    } // _InitializeLibrary

    //----------------------------------------------------------------------------------------------
    // private function _GetFreeDeviceNumber
    //----------------------------------------------------------------------------------------------
    private function _GetFreeDeviceNumber(variable i_strIPAddress,
                                          variable& o_blnAlreadyUsed,
                                          variable& o_intDeviceID) variable
    {
      o_blnAlreadyUsed = hslTrue;

      for(o_intDeviceID = 1; o_intDeviceID <= MAX_DEVICES; o_intDeviceID++)
        if(gInheco_ODTC_arrstrIPAddresses.GetAt(o_intDeviceID) == i_strIPAddress) return(hslTrue);

      o_blnAlreadyUsed = hslFalse;

      for(o_intDeviceID = 1; o_intDeviceID <= MAX_DEVICES; o_intDeviceID++)
      {
        if(gInheco_ODTC_arrstrIPAddresses.GetAt(o_intDeviceID) == "")
        {
          gInheco_ODTC_arrstrIPAddresses.SetAt(o_intDeviceID, i_strIPAddress);
          return(hslTrue);
        }
      }

      o_intDeviceID = -1;
      return(hslFalse);
    } // _GetFreeDeviceNumber

    // --------------------------------------------------------------------------------------
    // global function will be trigered by the C# component
    // --------------------------------------------------------------------------------------
    static global function gInheco_ODTC_objDevice_01_OnStatusEventHSL(variable i_intStatus,
                                                                      variable i_strStatusDescription) void
    {
      Hamilton_DriverTools::StatusTrace(Hamilton_DriverTools::ACTION::COMPLETE,
                                        TRACE_LEVEL_DEBUG,
                                        "Status = " + IStr(i_intStatus) +
                                        ", StatusDescription = '" + i_strStatusDescription + "'",
                                        "StatusEvent device 1",
                                        gInheco_ODTC_intTraceLevel,
                                        gInheco_ODTC_strModuleName);
    } // gInheco_ODTC_objDevice_01_OnStatusEventHSL

    // --------------------------------------------------------------------------------------
    // global function will be trigered by the C# component
    // --------------------------------------------------------------------------------------
    static global function gInheco_ODTC_objDevice_02_OnStatusEventHSL(variable i_intStatus,
                                                                      variable i_strStatusDescription) void
    {
      Hamilton_DriverTools::StatusTrace(Hamilton_DriverTools::ACTION::COMPLETE,
                                        TRACE_LEVEL_DEBUG,
                                        "Status = " + IStr(i_intStatus) +
                                        ", StatusDescription = '" + i_strStatusDescription + "'",
                                        "StatusEvent device 2",
                                        gInheco_ODTC_intTraceLevel,
                                        gInheco_ODTC_strModuleName);
    } // gInheco_ODTC_objDevice_02_OnStatusEventHSL

    // --------------------------------------------------------------------------------------
    // global function will be trigered by the C# component
    // --------------------------------------------------------------------------------------
    static global function gInheco_ODTC_objDevice_03_OnStatusEventHSL(variable i_intStatus,
                                                                      variable i_strStatusDescription) void
    {
      Hamilton_DriverTools::StatusTrace(Hamilton_DriverTools::ACTION::COMPLETE,
                                        TRACE_LEVEL_DEBUG,
                                        "Status = " + IStr(i_intStatus) +
                                        ", StatusDescription = '" + i_strStatusDescription + "'",
                                        "StatusEvent device 3",
                                        gInheco_ODTC_intTraceLevel,
                                        gInheco_ODTC_strModuleName);
    } // gInheco_ODTC_objDevice_03_OnStatusEventHSL

    // --------------------------------------------------------------------------------------
    // global function will be trigered by the C# component
    // --------------------------------------------------------------------------------------
    static global function gInheco_ODTC_objDevice_04_OnStatusEventHSL(variable i_intStatus,
                                                                      variable i_strStatusDescription) void
    {
      Hamilton_DriverTools::StatusTrace(Hamilton_DriverTools::ACTION::COMPLETE,
                                        TRACE_LEVEL_DEBUG,
                                        "Status = " + IStr(i_intStatus) +
                                        ", StatusDescription = '" + i_strStatusDescription + "'",
                                        "StatusEvent device 4",
                                        gInheco_ODTC_intTraceLevel,
                                        gInheco_ODTC_strModuleName);
    } // gInheco_ODTC_objDevice_04_OnStatusEventHSL

    // --------------------------------------------------------------------------------------
    // global function will be trigered by the C# component
    // --------------------------------------------------------------------------------------
    static global function gInheco_ODTC_objDevice_01_OnDataEventHSL(variable i_strDataValue) void
    {
      Hamilton_DriverTools::StatusTrace(Hamilton_DriverTools::ACTION::PROGRESS,
                                        TRACE_LEVEL_RELEASE,
                                        "DataValue = '" + i_strDataValue + "'",
                                        "DataEvent device 1",
                                        gInheco_ODTC_intTraceLevel,
                                        gInheco_ODTC_strModuleName);
    } // gInheco_ODTC_objDevice_01_OnDataEventHSL

    // --------------------------------------------------------------------------------------
    // global function will be trigered by the C# component
    // --------------------------------------------------------------------------------------
    static global function gInheco_ODTC_objDevice_02_OnDataEventHSL(variable i_strDataValue) void
    {
      Hamilton_DriverTools::StatusTrace(Hamilton_DriverTools::ACTION::PROGRESS,
                                        TRACE_LEVEL_RELEASE,
                                        "DataValue = '" + i_strDataValue + "'",
                                        "DataEvent device 2",
                                        gInheco_ODTC_intTraceLevel,
                                        gInheco_ODTC_strModuleName);
    } // gInheco_ODTC_objDevice_02_OnDataEventHSL

    // --------------------------------------------------------------------------------------
    // global function will be trigered by the C# component
    // --------------------------------------------------------------------------------------
    static global function gInheco_ODTC_objDevice_03_OnDataEventHSL(variable i_strDataValue) void
    {
      Hamilton_DriverTools::StatusTrace(Hamilton_DriverTools::ACTION::PROGRESS,
                                        TRACE_LEVEL_RELEASE,
                                        "DataValue = '" + i_strDataValue + "'",
                                        "DataEvent device 3",
                                        gInheco_ODTC_intTraceLevel,
                                        gInheco_ODTC_strModuleName);
    } // gInheco_ODTC_objDevice_03_OnDataEventHSL

    // --------------------------------------------------------------------------------------
    // global function will be trigered by the C# component
    // --------------------------------------------------------------------------------------
    static global function gInheco_ODTC_objDevice_04_OnDataEventHSL(variable i_strDataValue) void
    {
      Hamilton_DriverTools::StatusTrace(Hamilton_DriverTools::ACTION::PROGRESS,
                                        TRACE_LEVEL_RELEASE,
                                        "DataValue = '" + i_strDataValue + "'",
                                        "DataEvent device 4",
                                        gInheco_ODTC_intTraceLevel,
                                        gInheco_ODTC_strModuleName);
    } // gInheco_ODTC_objDevice_04_OnDataEventHSL

    // --------------------------------------------------------------------------------------
    // global function will be trigered by the C# component
    // --------------------------------------------------------------------------------------
    static global function gInheco_ODTC_objDevice_01_OnTemperatureEventHSL(variable i_fltElapsedTime,
                                                                           variable i_fltTargetTemperature,
                                                                           variable i_fltCurrentTemperature,
                                                                           variable i_fltLIDTemperature) void
    {
      Hamilton_DriverTools::StatusTrace(Hamilton_DriverTools::ACTION::PROGRESS,
                                        TRACE_LEVEL_RELEASE,
                                        "ElapsedTime = " + FStr(i_fltElapsedTime) +
                                        ", TargetTemperature = " + FStr(i_fltTargetTemperature) +
                                        ", CurrentTemperature = " + FStr(i_fltCurrentTemperature) +
                                        ", LIDTemperature = " + FStr(i_fltLIDTemperature),
                                        "TemperatureEvent device 1",
                                        gInheco_ODTC_intTraceLevel,
                                        gInheco_ODTC_strModuleName);
    } // gInheco_ODTC_objDevice_01_OnTemperatureEventHSL

    // --------------------------------------------------------------------------------------
    // global function will be trigered by the C# component
    // --------------------------------------------------------------------------------------
    static global function gInheco_ODTC_objDevice_02_OnTemperatureEventHSL(variable i_fltElapsedTime,
                                                                           variable i_fltTargetTemperature,
                                                                           variable i_fltCurrentTemperature,
                                                                           variable i_fltLIDTemperature) void
    {
      Hamilton_DriverTools::StatusTrace(Hamilton_DriverTools::ACTION::PROGRESS,
                                        TRACE_LEVEL_RELEASE,
                                        "ElapsedTime = " + FStr(i_fltElapsedTime) +
                                        ", TargetTemperature = " + FStr(i_fltTargetTemperature) +
                                        ", CurrentTemperature = " + FStr(i_fltCurrentTemperature) +
                                        ", LIDTemperature = " + FStr(i_fltLIDTemperature),
                                        "TemperatureEvent device 2",
                                        gInheco_ODTC_intTraceLevel,
                                        gInheco_ODTC_strModuleName);
    } // gInheco_ODTC_objDevice_02_OnTemperatureEventHSL

    // --------------------------------------------------------------------------------------
    // global function will be trigered by the C# component
    // --------------------------------------------------------------------------------------
    static global function gInheco_ODTC_objDevice_03_OnTemperatureEventHSL(variable i_fltElapsedTime,
                                                                           variable i_fltTargetTemperature,
                                                                           variable i_fltCurrentTemperature,
                                                                           variable i_fltLIDTemperature) void
    {
      Hamilton_DriverTools::StatusTrace(Hamilton_DriverTools::ACTION::PROGRESS,
                                        TRACE_LEVEL_RELEASE,
                                        "ElapsedTime = " + FStr(i_fltElapsedTime) +
                                        ", TargetTemperature = " + FStr(i_fltTargetTemperature) +
                                        ", CurrentTemperature = " + FStr(i_fltCurrentTemperature) +
                                        ", LIDTemperature = " + FStr(i_fltLIDTemperature),
                                        "TemperatureEvent device 3",
                                        gInheco_ODTC_intTraceLevel,
                                        gInheco_ODTC_strModuleName);
    } // gInheco_ODTC_objDevice_03_OnTemperatureEventHSL

    // --------------------------------------------------------------------------------------
    // global function will be trigered by the C# component
    // --------------------------------------------------------------------------------------
    static global function gInheco_ODTC_objDevice_04_OnTemperatureEventHSL(variable i_fltElapsedTime,
                                                                           variable i_fltTargetTemperature,
                                                                           variable i_fltCurrentTemperature,
                                                                           variable i_fltLIDTemperature) void
    {
      Hamilton_DriverTools::StatusTrace(Hamilton_DriverTools::ACTION::PROGRESS,
                                        TRACE_LEVEL_RELEASE,
                                        "ElapsedTime = " + FStr(i_fltElapsedTime) +
                                        ", TargetTemperature = " + FStr(i_fltTargetTemperature) +
                                        ", CurrentTemperature = " + FStr(i_fltCurrentTemperature) +
                                        ", LIDTemperature = " + FStr(i_fltLIDTemperature),
                                        "TemperatureEvent device 4",
                                        gInheco_ODTC_intTraceLevel,
                                        gInheco_ODTC_strModuleName);
    } // gInheco_ODTC_objDevice_04_OnTemperatureEventHSL
  }  // namespace 
#endif
// $$author=bhuf$$valid=1$$time=2016-01-08 15:13$$checksum=1d95c359$$length=081$$